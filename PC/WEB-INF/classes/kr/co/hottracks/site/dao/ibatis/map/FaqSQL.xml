<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="FaqSQL">
    <typeAlias alias="faqDomain" type="kr.co.hottracks.site.model.common.faq.FaqDomain"/>
    <typeAlias alias="faqParam" type="kr.co.hottracks.site.model.common.faq.FaqParam"/>
    <typeAlias alias="faqCriteria" type="kr.co.hottracks.site.model.common.faq.FaqCriteria"/>
    <typeAlias alias="codeDomain" type="kr.co.hottracks.site.model.common.faq.CodeDomain"/>
     <sql id="selectArticlesWhere">
        <isNotEmpty prepend="AND" property="title" removeFirstPrepend="true">
            (FAQ_TITLE LIKE ('%'||#title#||'%') OR FAQ_CONT LIKE ('%'||#title#||'%'))
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="categoryCode" removeFirstPrepend="true">
        	FAQ_CTGR_CODE = #categoryCode#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="mallId" removeFirstPrepend="true">
        	MALL_ID = #mallId#
        </isNotEmpty>
    </sql>
     
    <sql id="selectArticles_select_from">
    	SELECT
			FAQ_SEQ			seq,
			FAQ_CTGR_CODE	categoryCode,
			FAQ_TITLE		title,
			FAQ_CONT		cont,
			REGST_DTM		registDate,
			REGST_ADMIN_ID	registAdminID,
			HITS			hits
		FROM	
			 TB_FAQ
    </sql>
    <select id="selectArticles" parameterClass="faqCriteria" resultClass="faqDomain">
        /*FaqSQL.selectArticles*/
       	 <include refid="selectArticles_select_from"/>
       	 WHERE
       	 	'dumyCondition' = 'dumyCondition'
		 <include refid="selectArticlesWhere"/>
		 <isEqual  property="orderBy" compareValue="hits" >
        	ORDER BY hits DESC
         </isEqual>
         <isEqual  property="orderBy" compareValue="default" >
         	ORDER BY regst_dtm DESC
         </isEqual>
    </select>
    <select id="selectArticlesOrderByHit" parameterClass="faqCriteria" resultClass="faqDomain">
        /*FaqSQL.selectArticlesOrderByHit*/
			WITH V_TEMP AS (
				SELECT code FROM tb_code WHERE parnt_code = #categoryCode#
			)
			SELECT 
				F.faq_seq		seq
				, F.faq_ctgr_code	categoryCode
				, F.faq_title		title
				, F.faq_cont		cont
				, F.regst_dtm		registDate
				, F.regst_admin_id	registAdminID
				, F.hits 			hits
			FROM 
				v_temp V
				, tb_faq F
			WHERE 
				V.code = F.faq_ctgr_code
              AND F.mall_id = #mallId#
			<isNotEmpty property="title" removeFirstPrepend="true">
	        	AND (faq_title LIKE ('%'||#title#||'%') OR faq_cont LIKE ('%'||#title#||'%'))
	        </isNotEmpty>
 		    ORDER BY hits DESC
    </select>
    <select id="selectArticlesOrderByHitRowCount" parameterClass="faqCriteria" resultClass="int">
        /*FaqSQL.selectArticlesOrderByHitRowCount*/
        WITH V_TEMP AS (
			SELECT code FROM tb_code WHERE parnt_code = #categoryCode#
		)
		SELECT 
			count(F.faq_seq)
		FROM 
			v_temp V
			, tb_faq F
		WHERE 
			V.code = F.faq_ctgr_code
          AND F.mall_id = #mallId#
		<isNotEmpty property="title" removeFirstPrepend="true">
        	AND (faq_title LIKE ('%'||#title#||'%') OR faq_cont LIKE ('%'||#title#||'%'))
        </isNotEmpty>
		AND ROWNUM <![CDATA[ < ]]> #topCount# + 1
        
    </select>
    <select id="selectArticle" parameterClass="int" resultClass="faqDomain">
        /*FaqSQL.selectArticle*/
       SELECT	
			a.FAQ_SEQ			seq,
			a.FAQ_CTGR_CODE		categoryCode,
			a.FAQ_TITLE			title,
			a.FAQ_CONT			cont,
			a.REGST_DTM			registDate,
			a.REGST_ADMIN_ID	registAdminID,
			a.HITS				hits,
			b.parnt_code    	parentCode,
			a.mall_id			mallId
		FROM	
			 TB_FAQ a, TB_CODE b 
	 	WHERE
	 		FAQ_SEQ = #seq#
	 	AND
	 		a.faq_ctgr_code = b.code
	 	
    </select>
    <select id="selectArticlesRowCount" parameterClass="faqCriteria" resultClass="int">
        /*FaqSQL.selectArticlesRowCount*/
        SELECT
            COUNT(FAQ_SEQ)
        FROM	
			 TB_FAQ
		WHERE
 	 		'dumyCondition' = 'dumyCondition'
			<include refid="selectArticlesWhere"/>
       		AND ROWNUM <![CDATA[ < ]]> #topCount# + 1
                
          
          
    </select>
    <select id="selectCodes" parameterClass="string" resultClass="codeDomain">
    	/*FaqSQL.selectCodes*/
    	SELECT			
			code		code,	
			code_name	codeName
		FROM	
			tb_code
		WHERE
			parnt_code = #code#    	
    </select>
    <update id="updateHits" parameterClass="int">
    	/*FaqSQL.updateHits*/
		UPDATE		
			tb_faq	
		SET			
			HITS		 	= 	HITS + 1
		WHERE			
			FAQ_SEQ			=	#seq#
    </update>
    
    <update id="updateArticle" parameterClass="faqDomain">
    	/*FaqSQL.updateAtricle*/
		UPDATE		
			tb_faq	
		SET			
			FAQ_CTGR_CODE	=	#categoryCode#,
			FAQ_TITLE		=	#title#,
			FAQ_CONT		=	#cont#,
			REGST_DTM		=	sysdate,
			REGST_ADMIN_ID	=	#registAdminID#,
			MALL_ID			=	#mallId#
		WHERE			
			FAQ_SEQ			=	#seq#
    </update>
    <delete id="deleteArticle" parameterClass="int">
    	/*FaqSQL.deleteAtricle*/
    	DELETE
    		tb_faq
    	WHERE
    		faq_seq = #seq#
    
    </delete>
    <select id="selectRowCount" resultClass="int">
    	SELECT	
    		count(faq_seq) rowCount
    	FROM
    		tb_faq
    </select>
    
    <select id="selectTopSeq" resultClass="int">
    	SELECT
    		MAX(faq_seq)
    	FROM
    		tb_faq
    </select>
    
    <select id="selectFaqListForMotherMall" parameterClass="faqCriteria" resultClass="faqDomain">
        SELECT  A.faq_seq       seq
              , A.faq_ctgr_code categoryCode
              , A.faq_title     title
              , A.faq_cont      cont
              , A.regst_dtm     registDate
              , A.hits          hits
          FROM  tb_faq A
         WHERE  A.mall_id = #mallId#
        <isNotEmpty property="title">
            AND (UPPER(A.faq_title) LIKE ('%'||UPPER(#title#)||'%') OR UPPER(A.faq_cont) LIKE ('%'||UPPER(#title#)||'%'))
        </isNotEmpty>
        <isNotEmpty property="categoryCode">
            AND A.faq_ctgr_code = #categoryCode#
        </isNotEmpty>
        <isNotEmpty property="orderBy">
            ORDER BY A.hits DESC
        </isNotEmpty>
        <isEmpty property="orderBy">
            ORDER BY A.regst_dtm DESC
        </isEmpty>
    </select>
    
    <select id="selectFaqListCountForMotherMall" parameterClass="faqCriteria" resultClass="int">
        SELECT  COUNT(*)
          FROM  tb_faq A
         WHERE  A.mall_id = #mallId#
        <isNotEmpty property="title">
            AND (UPPER(A.faq_title) LIKE ('%'||UPPER(#title#)||'%') OR UPPER(A.faq_cont) LIKE ('%'||UPPER(#title#)||'%'))
        </isNotEmpty>
        <isNotEmpty property="categoryCode">
            AND A.faq_ctgr_code = #categoryCode#
        </isNotEmpty>
           AND  ROWNUM <![CDATA[ < ]]> #topCount# + 1
    </select>
</sqlMap>