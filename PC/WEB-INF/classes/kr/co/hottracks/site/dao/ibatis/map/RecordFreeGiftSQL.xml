<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="RecordFreeGiftSQL">
    <typeAlias alias="fgiftMasterCriteria" type="kr.co.hottracks.site.model.common.record.FgiftMasterCriteria"/>
    <typeAlias alias="fgiftMasterExt" type="kr.co.hottracks.site.model.common.record.FgiftMasterExt"/>
    
    <select id="getSupplementMasterListForCategory" parameterClass="fgiftMasterCriteria" resultClass="fgiftMasterExt">
        /* RecordFreeGiftSQL.getSupplementMasterListForCategory */
        select 
            a.fgift_master_seq fgiftMasterSeq
            , a.fgift_title suppName
            , a.live_cnt suppStockCnt
        from (select distinct c.title title , e.title fgift_title, e.live_cnt, e.fgift_seq, c.fgift_master_seq, c.fgift_prdt_code
                from (select sell_prdt_bcode, ctgr_id
                        from tb_product_category
                       where sell_prdt_bcode = #keyWord#
                     ) a 
               join tb_fgift_product b on a.sell_prdt_bcode = b.sell_prdt_bcode 
               join tb_fgift_master c on b.fgift_master_seq = c.fgift_master_seq and c.fgift_prdt_code = 'C0952' 
               and c.fgift_code = 'C0982' and c.use_yn = 'Y' and (to_char(sysdate,'YYYYMMDDHH24MISS')  between c.prsnt_start_day and c.prsnt_end_day or (to_char(sysdate,'YYYYMMDDHH24MISS')  > c.prsnt_start_day and c.prsnt_limit_yn = 'Y' )) 
               join tb_fgift_fgift d on c.fgift_master_seq = d.fgift_master_seq 
               join tb_fgift e on d.fgift_seq = e.fgift_seq and e.fgift_type = 'C0962' 
               union all
               select distinct c.title title , e.title fgift_title, e.live_cnt, e.fgift_seq, c.fgift_master_seq, c.fgift_prdt_code
                from (select sell_prdt_bcode, ctgr_id
                        from tb_product_category
                       where sell_prdt_bcode = #keyWord#
                     ) a 
               join tb_fgift_master c on a.ctgr_id like c.ctgr_id || '%' and c.fgift_prdt_code = 'C0951' 
               and c.fgift_code = 'C0982' and c.use_yn = 'Y' and (to_char(sysdate,'YYYYMMDDHH24MISS')  between c.prsnt_start_day and c.prsnt_end_day or (to_char(sysdate,'YYYYMMDDHH24MISS')  > c.prsnt_start_day and c.prsnt_limit_yn = 'Y' )) 
               join tb_fgift_fgift d on c.fgift_master_seq = d.fgift_master_seq 
               join tb_fgift e on d.fgift_seq = e.fgift_seq and e.fgift_type = 'C0962' 
            ) a
        order by a.fgift_master_seq
    </select>
    
    <select id="getFgiftMasterListForOrder" parameterClass="string" resultClass="fgiftMasterExt">
        /* RecordFreeGiftSQL.getFgiftMasterListForOrder */
        select a.fgift_master_seq fgiftMasterSeq
          from (select distinct c.title title , e.title fgift_title, e.live_cnt, e.fgift_seq, c.fgift_master_seq, c.fgift_prdt_code
                  from (select sell_prdt_bcode, ctgr_id
                          from tb_product_category
                         where sell_prdt_bcode = #sellPrdtBcode#
                       ) a 
                 join tb_fgift_product b on a.sell_prdt_bcode = b.sell_prdt_bcode 
                 join tb_fgift_master c on b.fgift_master_seq = c.fgift_master_seq and c.fgift_prdt_code = 'C0952' 
                 and c.fgift_code = 'C0981' and c.use_yn = 'Y' and (to_char(sysdate,'YYYYMMDDHH24MISS')  between c.prsnt_start_day and c.prsnt_end_day or (to_char(sysdate,'YYYYMMDDHH24MISS')  > c.prsnt_start_day and c.prsnt_limit_yn = 'Y' )) 
                 join tb_fgift_fgift d on c.fgift_master_seq = d.fgift_master_seq 
                 join tb_fgift e on d.fgift_seq = e.fgift_seq and e.fgift_type = 'C0961' 
                 union all
                 select distinct c.title title , e.title fgift_title, e.live_cnt, e.fgift_seq, c.fgift_master_seq, c.fgift_prdt_code
                     from (select sell_prdt_bcode, ctgr_id
                             from tb_product_category
                            where sell_prdt_bcode = #sellPrdtBcode#
                          ) a 
                 join tb_fgift_master c on a.ctgr_id like c.ctgr_id || '%' and c.fgift_prdt_code = 'C0951' 
                 and c.fgift_code = 'C0981' and c.use_yn = 'Y' and (to_char(sysdate,'YYYYMMDDHH24MISS')  between c.prsnt_start_day and c.prsnt_end_day or (to_char(sysdate,'YYYYMMDDHH24MISS')  > c.prsnt_start_day and c.prsnt_limit_yn = 'Y' )) 
                 join tb_fgift_fgift d on c.fgift_master_seq = d.fgift_master_seq 
                 join tb_fgift e on d.fgift_seq = e.fgift_seq and e.fgift_type = 'C0961' 
             ) a
        order by a.fgift_master_seq
    </select>
</sqlMap>