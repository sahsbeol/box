<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="BizFrontEventSQL">
<typeAlias alias="bizEventCriteria" type="kr.co.hottracks.site.model.renewal.event.BizEventCriteria"/>
<typeAlias alias="bizEventExt" type="kr.co.hottracks.site.model.renewal.event.BizEventExt"/>
<typeAlias alias="bizEventSellProductExt" type="kr.co.hottracks.site.model.renewal.event.BizEventSellProductExt"/>
    <!-- 
        작성자: 장진용
        작성일: 2015-06-31
        기능: 브랜드별 이벤트목록반환
     -->
    <select id="getEventListByBrand" parameterClass="kr.co.hottracks.site.model.renewal.event.EventCriteria" resultClass="kr.co.hottracks.site.model.renewal.event.BizEventExt">
        /* BizFrontEventSQL.getEventListByBrand */
        SELECT 1                dispOrder
             , EM.EVENT_ID      	eventId
             , EM.EVENT_TITLE   	eventTitle
             , EM.EVENT_DTL_CONT    eventDtlCont
             , TB.DISC_RATE			discRate
             , TI.IMAGE_URL     	imageUrl
          FROM TB_EVENT_MASTER EM
          LEFT JOIN TM_BNR TB ON EM.EVENT_ID = TB.EVENT_ID
          LEFT JOIN TB_EVENT_IMAGE TI ON TI.EVENT_ID = EM.EVENT_ID AND TI.EVENT_IMAGE_CODE = 'C0381'
         WHERE EM.EVENT_STAT_CODE = 'C0181'
           AND EM.EVENT_TYPE_CODE NOT IN ('C0196', 'C0198')
           AND EM.PRMT_CODE = 'C0374'
           AND EM.DISP_YN = 'Y'
           AND EM.BRAND_ID = #brandId#
           AND EM.EVENT_START_DT &lt;= TO_CHAR(SYSDATE, 'YYYYMMDD')
           AND EM.EVENT_END_DT >= TO_CHAR(SYSDATE, 'YYYYMMDD')
           AND EXISTS (SELECT 1 FROM TB_MALL_EVENT ME WHERE EM.EVENT_ID = ME.EVENT_ID AND ME.MALL_ID = #mallId#)
         UNION ALL
        SELECT 2                	dispOrder
             , EM.EVENT_ID      	eventId
             , EM.EVENT_TITLE   	eventTitle
             , EM.EVENT_DTL_CONT    eventDtlCont
             , TB.DISC_RATE			discRate
             , TI.IMAGE_URL     	imageUrl
          FROM TB_EVENT_MASTER EM
          JOIN TB_EVENT_SELL_PRODUCT ESP ON EM.EVENT_ID = ESP.EVENT_ID
          JOIN TB_SELL_PRODUCT SP ON ESP.SELL_PRDT_BCODE = SP.SELL_PRDT_BCODE AND SP.BRAND_ID = #brandId#
          LEFT JOIN TM_BNR TB ON EM.EVENT_ID = TB.EVENT_ID
          LEFT JOIN TB_EVENT_IMAGE TI ON TI.EVENT_ID = EM.EVENT_ID AND TI.EVENT_IMAGE_CODE = 'C0381'
         WHERE EM.EVENT_STAT_CODE = 'C0181'
           AND EM.EVENT_TYPE_CODE NOT IN ('C0196', 'C0198')
           AND EM.PRMT_CODE = 'C0374'
           AND EM.DISP_YN = 'Y'
           AND EM.EVENT_START_DT &lt;= TO_CHAR(SYSDATE, 'YYYYMMDD')
           AND EM.EVENT_END_DT >= TO_CHAR(SYSDATE, 'YYYYMMDD')
           AND EXISTS (SELECT 1 FROM TB_MALL_EVENT ME WHERE EM.EVENT_ID = ME.EVENT_ID AND ME.MALL_ID = #mallId#)
         GROUP BY EM.EVENT_ID, EM.EVENT_TITLE, EM.EVENT_DTL_CONT, TB.DISC_RATE, TI.IMAGE_URL
         ORDER BY dispOrder, eventId DESC
    </select>
    <!--  
        작성자: 
        작성일 : 
        기능 : 이벤트 목록 반환
    -->
    <select id="getEventList" parameterClass="bizEventCriteria" resultClass="bizEventExt">
        /* BizFrontEventSQL.getEventList */
        SELECT A.EVENT_ID           eventId
             , B.IMAGE_URL          imageUrl
             , A.CTGR_ID            ctgrId
             , A.EVENT_TITLE        eventTitle
             , A.EVENT_DTL_CONT     eventDtlCont
             , A.EVENT_START_DT     eventStartDt
             , A.EVENT_END_DT       eventEndDt
             , A.EVENT_RANGE_INFO   eventRangeInfo
             , A.STD_DSCNT_RATE     stdDscntRate
             , A.DISP_DSCNT_RATE    dispDscntRate
          FROM TB_EVENT_MASTER A    
          JOIN TB_EVENT_IMAGE B ON A.EVENT_ID = B.EVENT_ID AND B.EVENT_IMAGE_CODE = #eventImageCode#
          JOIN TB_MALL_EVENT C ON A.EVENT_ID = C.EVENT_ID AND C.MALL_ID = #mallId#
          <isNotEmpty property="orderBy">
              <isEqual property="orderBy" compareValue="P">
                  LEFT JOIN (SELECT ESP.EVENT_ID
                                  , SUM(OP.ORDER_COUNT - OP.CANC_COUNT) CNT
                               FROM TB_ORDER O
                               JOIN TB_ORDER_PRODUCT OP ON O.ORDER_NUM = OP.ORDER_NUM AND OP.ORDER_PRDT_STAT_CODE = 'C0171'
                               JOIN TB_SELL_PRODUCT SP ON OP.SELL_PRDT_BCODE = SP.SELL_PRDT_BCODE AND SP.SELL_PRDT_GBN IN ('P', 'G', 'S') AND SP.PRMT_CODE = 'C0302' AND SP.PRDT_STAT_CODE = 'C0312'
                               JOIN TB_VENDOR_CONTRACT VC ON SP.VNDR_CNTRT_ID = VC.VNDR_CNTRT_ID AND TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN VC.CNTRT_START_DT AND VC.CNTRT_END_DT AND VC.VNDR_CNTRT_STAT_CODE = 'C0072'
                               JOIN TB_EVENT_SELL_PRODUCT ESP ON ESP.SELL_PRDT_BCODE = DECODE(SP.SELL_PRDT_GBN, 'S', SP.PRIME_SELL_PRDT_BCODE, SP.SELL_PRDT_BCODE)
                              WHERE O.ORDER_DTM BETWEEN TO_DATE(TO_CHAR(SYSDATE-7, 'YYYYMMDD')||'000000', 'YYYYMMDDHH24MISS') AND SYSDATE
                                AND O.MALL_ID = '02'
                                AND O.ORDER_STATUS_CODE != 'C0281'
                              GROUP BY ESP.EVENT_ID
                            ) T ON A.EVENT_ID = T.EVENT_ID
               </isEqual>
           </isNotEmpty>
         WHERE TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN A.EVENT_START_DT AND A.EVENT_END_DT
           AND A.EVENT_STAT_CODE = 'C0181'    /* 정상 */
           AND A.PRMT_CODE = 'C0374'          /* 승인완료 */
           AND A.EVENT_TYPE_CODE NOT IN ('C0196', 'C0198')    /* 오늘만특가,코멘트C,뮤직샵상품할인 */
           AND A.CTGR_ID LIKE #ctgrId#  || '%'
           AND A.DISP_YN = 'Y'
           AND FC_IS_VALID_EVENT(A.EVENT_ID, #mallId#) = 'Y'
           AND B.IMAGE_URL IS NOT NULL
           <isEmpty property="newEventDispTypeCode" prepend="AND">
                A.NEW_EVENT_DISP_TYPE_CODE NOT IN ('C1533','C1532','C1534')
           </isEmpty>
           <isNotEmpty property="newEventDispTypeCode" prepend="AND">
                A.NEW_EVENT_DISP_TYPE_CODE = #newEventDispTypeCode#
           </isNotEmpty>
           <isEqual property="cultZoneYn" compareValue="true" prepend="AND">
               A.CULT_ZONE_YN = 'Y'
           </isEqual>
           <isEqual property="eventId" compareValue="true" prepend="AND">
               A.EVENT_ID = #eventId#
           </isEqual>
         <dynamic>
            <isEmpty property="orderBy">ORDER BY A.EVENT_START_DT DESC,REGST_DTM</isEmpty>
            <isNotEmpty property="orderBy">
                <isEqual property="orderBy" compareValue="P">ORDER BY NVL(T.CNT, 0) DESC</isEqual>
                <isEqual property="orderBy" compareValue="N">ORDER BY A.EVENT_START_DT DESC,REGST_DTM</isEqual>
                <isEqual property="orderBy" compareValue="O">ORDER BY A.EVENT_END_DT,REGST_DTM</isEqual>
                <isEqual property="orderBy" compareValue="M">ORDER BY A.REGST_DTM DESC</isEqual>
            </isNotEmpty>
         </dynamic>
    </select>
    
    <!--  
        작성자: 장진용
        작성일 : 2014.08.05
        기능 : 이벤트 목록 수 반환
    -->
    <select id="countEventList" parameterClass="bizEventCriteria" resultClass="int">
        /* BizFrontEventSQL.countEventList */
        SELECT COUNT(*) as CNT
          FROM TB_EVENT_MASTER A
          JOIN TB_EVENT_IMAGE B ON A.EVENT_ID = B.EVENT_ID AND B.EVENT_IMAGE_CODE = #eventImageCode#
          JOIN TB_MALL_EVENT C ON A.EVENT_ID = C.EVENT_ID AND C.MALL_ID = #mallId#
         WHERE TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN A.EVENT_START_DT AND A.EVENT_END_DT
           AND A.EVENT_STAT_CODE = 'C0181'    /* 정상 */
           AND A.PRMT_CODE = 'C0374'          /* 승인완료 */
           AND A.EVENT_TYPE_CODE NOT IN ('C0196', 'C0198')    /* 오늘만특가,코멘트C,뮤직샵상품할인 */
           AND A.CTGR_ID LIKE #ctgrId#  || '%'
           AND A.DISP_YN = 'Y'
           AND FC_IS_VALID_EVENT(A.EVENT_ID, #mallId#) = 'Y'
           <isNotEmpty property="newEventDispTypeCode" prepend="AND">
                A.NEW_EVENT_DISP_TYPE_CODE = #newEventDispTypeCode#
           </isNotEmpty>
           <isEqual property="cultZoneYn" compareValue="true" prepend="AND">
               A.CULT_ZONE_YN = 'Y'
           </isEqual>
           <isEqual property="eventId" compareValue="true" prepend="AND">
               A.EVENT_ID = #eventId#
           </isEqual>
           AND ROWNUM &lt; #topCount# + 1
    </select>
	<!-- 
        작성자: 장진용
        작성일: 2014-08-05
        기능: 해당이벤트와 같은 전시유형의 이벤트 목록 반환
    -->
    <select id="getEventCategory" parameterClass="kr.co.hottracks.site.model.renewal.event.EventCriteria" resultClass="kr.co.hottracks.site.model.renewal.event.EventExt">
        /* BizFrontEventSQL.getEventCategory */
        SELECT A.EVENT_ID               eventId
             , A.EVENT_TITLE            eventTitle
             , (SELECT IMAGE_URL FROM TB_EVENT_IMAGE SA WHERE SA.EVENT_ID = A.EVENT_ID AND SA.EVENT_IMAGE_CODE = 'C0388')    imageUrl
             , NVL(A.CTGR_Id, '00')     ctgrId
          FROM TB_EVENT_MASTER A
          JOIN TB_MALL_EVENT B ON A.EVENT_ID = B.EVENT_ID AND B.MALL_ID = #mallId#
         WHERE TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN A.EVENT_START_DT AND A.EVENT_END_DT
           AND A.EVENT_STAT_CODE = 'C0181'    /* 정상 */
           AND A.PRMT_CODE = 'C0374'          /* 승인완료 */
           AND A.EVENT_TYPE_CODE NOT IN ('C0196', 'C0198')    /* 오늘만특가,코멘트C,뮤직샵상품할인 */
           AND A.DISP_YN = 'Y'
           AND A.CTGR_Id IN #ctgrId#
         ORDER BY A.EVENT_ID DESC 
    </select>
    
    <!-- 
        작성자: 장진용
        작성일: 2014-08-05
        기능: 이벤트 상품 전시 유형별 상품목록
    -->
    <select id="getProductListByDisplayType" parameterClass="bizEventCriteria" resultClass="bizEventSellProductExt">
        /* FrontEventSQL.getProductListByDisplayType */
        SELECT A.EVENT_ID           eventId
             , A.SELL_PRDT_BCODE    sellPrdtBcode
             , A.EVENT_DSCNT_RATE   eventDscntRate
             , FC_GET_PRODUCT_IMAGE_URL(A.SELL_PRDT_BCODE)     prdtImageUrl
             , FC_GET_PRODUCT_IMAGE_URL2(A.SELL_PRDT_BCODE)    productImageUrl2
             , A.EVENT_TYPE_INSEQ   eventTypeInseq
             , A.MAIN_YN            mainYn
             , A.CHGE_RATE          chgeRate
             , A.FREE_DLVY_YN       freeDlvyYn
             , A.DISP_ORDER         dispOrder
             , A.PRDT_QNA_SEQ       prdtQnaSeq
             , A.EVENT_DSCNT_AMT    eventDscntAmt
             , A.CHGE_AMT           chgeAmt
             , B.NYO_SELL_BAN_YN    nyoSellBanYn
             , FC_GET_PRDT_NAME(B.SELL_PRDT_BCODE, #mallId#)    prdtName
             , B.PRDT_SELL_PRICE    prdtSellPrice
             , FC_GET_DC_RATE_MALL(B.SELL_PRDT_BCODE, '02')        lastDcRate
             , B.SELL_PRDT_GBN      sellPrdtGbn
             , CASE WHEN B.SELL_PRDT_GBN IN ('R', 'D') AND FC_REC_GET_SALE_YN(D.STOCK_CNT_PRODUCT, B.RCRD_STAT, B.RCRD_HARD_SALE_YN, B.RCRD_LSALE_START_DTH, B.RCRD_LSALE_END_DTH, B.LAVE_COUNT) != 'Y' THEN 'C0313'
                    ELSE B.PRDT_STAT_CODE
                END                 prdtStatCode
             , C.RCRD_CD            rcrdCd
             , C.RTNG_CODE          rtngCode
             , CASE WHEN B.SELL_PRDT_GBN IN ('R', 'D')
                    THEN C.ARTI_NAME
                    ELSE (SELECT NVL(RA.BRAND_ENG_NAME, RA.BRAND_NAME) FROM TB_BRAND RA WHERE B.BRAND_ID = RA.BRAND_ID)
               END                  brandName
             , CASE WHEN B.SELL_PRDT_GBN IN ('R', 'D') THEN B.PRDT_SAVED_RATE
                    WHEN FC_GET_CHGE_RATE(A.SELL_PRDT_BCODE, #mallId#) > 20 THEN 1
                    ELSE 0
               END                  savedRate
             , FC_GET_CPN_LAST_PRICE(A.SELL_PRDT_BCODE, #mallId#,#userNum#)     lastCpnPrice
             , FC_GET_PRODUCT_ICON_CODE(A.SELL_PRDT_BCODE, '02')                prdtIcon
             , FC_GET_REVIEW_PRODUCT_COUNT(A.SELL_PRDT_BCODE, '02')             reviewCount
             , FC_GET_WISH_PRODUCT_COUNT(A.SELL_PRDT_BCODE, '02')               wishPrdtCnt
             , nvl((SELECT COUNT(1) FROM TB_WISH_PRODUCT TP WHERE TP.WISH_GBN = 'P' AND TP.SELL_PRDT_BCODE =  A.SELL_PRDT_BCODE AND TP.MALL_ID = '02' AND TP.USER_NUM = #userNum#), 0) as wishUserPrdtCnt
             , DECODE((SELECT COUNT(*) FROM TB_POSTER_CASE PC WHERE TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN PC.PRSNT_START_DAY AND PRSNT_END_DAY AND PC.SELL_PRDT_BCODE = b.SELL_PRDT_BCODE), '0', 'N', 'Y') as hasPosterCaseYn
             , C.IMP_YN                         impYn
             , B.RCRD_STAT                      rcrdStat
          FROM TB_EVENT_SELL_PRODUCT A
          JOIN TB_SELL_PRODUCT B ON A.SELL_PRDT_BCODE = B.SELL_PRDT_BCODE AND B.PRMT_CODE = 'C0302' AND B.PRDT_STAT_CODE != 'C0315'
          LEFT JOIN TB_RECORD C ON B.RCRD_CD = C.RCRD_CD
          LEFT JOIN TB_REC_PROD_STOCK_LAST D ON B.SELL_PRDT_BCODE = D.SELL_PRDT_BCODE
         WHERE A.EVENT_ID = #eventId#
           AND A.EVENT_TYPE_INSEQ = #eventTypeInseq#
           AND FC_IS_VALID_PRODUCT(A.SELL_PRDT_BCODE, #mallId#) = 'Y'
           <isNotEmpty property="mainYn" prepend="AND">
               A.MAIN_YN = #mainYn#
           </isNotEmpty>
         ORDER BY A.DISP_ORDER, B.PRMT_DTM DESC
    </select>
   <!-- 
        작성자 : 장진용
        작성일 : 2014-08-18
        기능 : 검색조건에 맞는 이벤트 목록 반환[검색페이지]
    -->
    <select id="getEventList4Search" parameterClass="kr.co.hottracks.site.model.frontoffice.search.SearchCriteria" resultClass="bizEventExt">
        /* FrontEventSQL.getEventList4Search */
        SELECT A.EVENT_ID           eventId
             , A.EVENT_TITLE        eventTitle
             , A.EVENT_DTL_CONT     eventDtlCont
             , B.IMAGE_URL          imageUrl
             , A.EVENT_START_DT     eventStartDt
             , A.EVENT_END_DT       eventEndDt
             , A.EVENT_RANGE_INFO   eventRangeInfo
             , A.STD_DSCNT_RATE     stdDscntRate
             , A.DISP_DSCNT_RATE    dispDscntRate
             , CASE WHEN (#searchMenu# = 'GIFT' AND A.CTGR_ID LIKE '0000%') OR (#searchMenu# = 'RECORD' AND A.CTGR_ID NOT LIKE '0000%') THEN 1 ELSE 99 END ord1
             , CASE WHEN UPPER(A.EVENT_SRCH_WORD) LIKE UPPER('%'||#searchTerm#||'%') THEN 1 ELSE 99 END ord2
             , CASE WHEN UPPER(A.EVENT_TITLE) LIKE UPPER('%'||#searchTerm#||'%') THEN 1 ELSE 99 END ord3
        FROM TB_EVENT_MASTER A
        LEFT JOIN TB_EVENT_IMAGE B ON A.EVENT_ID = B.EVENT_ID AND B.EVENT_IMAGE_CODE = 'C0382'
        JOIN TB_MALL_EVENT C ON A.EVENT_ID = C.EVENT_ID AND C.MALL_ID = '02'
       WHERE TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN A.EVENT_START_DT AND A.EVENT_END_DT
         AND A.PRMT_CODE = 'C0374'
         AND A.EVENT_STAT_CODE = 'C0181'
         AND A.DISP_YN = 'Y'
         AND A.EVENT_TYPE_CODE NOT IN ('C0196', 'C0198')
         <dynamic prepend="and" open="(" close=")" >
             <isNotEmpty property="cmpsr" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#cmpsr#||'%'
             </isNotEmpty>
             <isNotEmpty property="rcrd_name" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#rcrd_name#||'%'
             </isNotEmpty>
             <isNotEmpty property="prfmr_kor" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#prfmr_kor#||'%'
             </isNotEmpty>
              <isNotEmpty property="vocal" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#vocal#||'%'
             </isNotEmpty>
              <isNotEmpty property="ocstr" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#ocstr#||'%'
             </isNotEmpty>
              <isNotEmpty property="istmt_kor" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#istmt_kor#||'%'
             </isNotEmpty>
              <isNotEmpty property="jmcode" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#jmcode#||'%'
             </isNotEmpty>
              <isNotEmpty property="trk_name" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#trk_name#||'%'
             </isNotEmpty>
             <isNotEmpty property="drctr" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#drctr#||'%'
             </isNotEmpty>
              <isNotEmpty property="actor" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#actor#||'%'
             </isNotEmpty>
             <isNotEmpty property="label_name" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#label_name#||'%'
             </isNotEmpty>
             <isNotEmpty property="arti_name" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#arti_name#||'%'
             </isNotEmpty>
             <isNotEmpty property="cndtr" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#cndtr#||'%'
             </isNotEmpty>
             <isNotEqual property="searchTerm" compareValue=" " prepend="or" removeFirstPrepend="true">
                   UPPER(A.EVENT_TITLE||' '||A.EVENT_SRCH_WORD||' '||EVENT_DTL_CONT) LIKE UPPER('%'||#searchTerm#||'%')
             </isNotEqual>
         </dynamic>
        ORDER BY ord1, ord2, ord3, A.EVENT_START_DT DESC, A.ICON_CLICK_COUNT DESC  
    </select>
    
    
    <!-- 
        작성자 : 장진용
        작성일 : 2017-10-01
        기능 : 추천 이벤트 목록 반환[검색페이지]
    -->
    <select id="getEventChoice4Search" parameterClass="kr.co.hottracks.site.model.frontoffice.search.SearchCriteria" resultClass="bizEventExt">
        /* FrontEventSQL.getEventChoice4Search */
        SELECT eventId
        	 , eventTitle
        	 , eventId        
        	 , eventTitle     
        	 , eventDtlCont   
        	 , imageUrl       
        	 , eventStartDt   
        	 , eventEndDt     
        	 , eventRangeInfo 
        	 , stdDscntRate 
        	 , COUNT(E.EVENT_ID) clickCount  
          FROM (
        SELECT A.EVENT_ID           eventId
             , A.EVENT_TITLE        eventTitle
             , A.EVENT_DTL_CONT     eventDtlCont
             , B.IMAGE_URL          imageUrl
             , A.EVENT_START_DT     eventStartDt
             , A.EVENT_END_DT       eventEndDt
             , A.EVENT_RANGE_INFO   eventRangeInfo
             , A.STD_DSCNT_RATE     stdDscntRate
        FROM TB_EVENT_MASTER A
        LEFT JOIN TB_EVENT_IMAGE B ON A.EVENT_ID = B.EVENT_ID AND B.EVENT_IMAGE_CODE = 'C0382'
        JOIN TB_MALL_EVENT C ON A.EVENT_ID = C.EVENT_ID AND C.MALL_ID = '02'
       WHERE A.EVENT_START_DT BETWEEN TO_CHAR(SYSDATE-3, 'YYYYMMDD') AND TO_CHAR(SYSDATE, 'YYYYMMDD')
     	 AND A.EVENT_END_DT &gt; SYSDATE
         AND A.PRMT_CODE = 'C0374'
         AND A.EVENT_STAT_CODE = 'C0181'
         AND A.DISP_YN = 'Y'
         AND A.EVENT_TYPE_CODE NOT IN ('C0196', 'C0198')
         AND B.IMAGE_URL IS NOT NULL
         <dynamic prepend="AND" open=" NOT (" close=")" >
             <isNotEmpty property="cmpsr" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#cmpsr#||'%'
             </isNotEmpty>
             <isNotEmpty property="rcrd_name" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#rcrd_name#||'%'
             </isNotEmpty>
             <isNotEmpty property="prfmr_kor" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#prfmr_kor#||'%'
             </isNotEmpty>
              <isNotEmpty property="vocal" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#vocal#||'%'
             </isNotEmpty>
              <isNotEmpty property="ocstr" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#ocstr#||'%'
             </isNotEmpty>
              <isNotEmpty property="istmt_kor" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#istmt_kor#||'%'
             </isNotEmpty>
              <isNotEmpty property="jmcode" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#jmcode#||'%'
             </isNotEmpty>
              <isNotEmpty property="trk_name" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#trk_name#||'%'
             </isNotEmpty>
             <isNotEmpty property="drctr" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#drctr#||'%'
             </isNotEmpty>
              <isNotEmpty property="actor" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#actor#||'%'
             </isNotEmpty>
             <isNotEmpty property="label_name" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#label_name#||'%'
             </isNotEmpty>
             <isNotEmpty property="arti_name" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#arti_name#||'%'
             </isNotEmpty>
             <isNotEmpty property="cndtr" prepend="or" removeFirstPrepend="true">
                 A.EVENT_TITLE LIKE '%'||#cndtr#||'%'
             </isNotEmpty>
             <isNotEqual property="searchTerm" compareValue=" " prepend="or" removeFirstPrepend="true">
                   UPPER(A.EVENT_TITLE||' '||A.EVENT_SRCH_WORD||' '||EVENT_DTL_CONT) LIKE UPPER('%'||#searchTerm#||'%')
             </isNotEqual>
         </dynamic>
         )t LEFT JOIN TB_RECENT_EVENT E ON eventId = E.EVENT_ID 
       GROUP BY eventId,eventTitle,eventId,eventTitle,eventDtlCont,imageUrl,eventStartDt,eventEndDt,eventRangeInfo,stdDscntRate
       ORDER BY eventStartDt DESC, COUNT(E.EVENT_ID) DESC

    </select>
<!--  
        작성자: 
        작성일 : 
        기능 : 이벤트 목록 반환
    -->
    <select id="getEventMainScrollList" parameterClass="bizEventCriteria" resultClass="bizEventExt">
        /* BizFrontEventSQL.getEventMainScrollList */
        SELECT A.EVENT_ID           eventId
             , B.IMAGE_URL          imageUrl
             , A.CTGR_ID            ctgrId
             , A.EVENT_TITLE        eventTitle
             , A.EVENT_DTL_CONT     eventDtlCont
             , A.EVENT_START_DT     eventStartDt
             , A.EVENT_END_DT       eventEndDt
             , A.EVENT_RANGE_INFO   eventRangeInfo
             , A.STD_DSCNT_RATE     stdDscntRate
             , A.DISP_DSCNT_RATE    dispDscntRate
          FROM TB_EVENT_MASTER A    
          JOIN TB_EVENT_IMAGE B ON A.EVENT_ID = B.EVENT_ID AND B.EVENT_IMAGE_CODE = #eventImageCode#
          JOIN TB_MALL_EVENT C ON A.EVENT_ID = C.EVENT_ID AND C.MALL_ID = #mallId#
          <isNotEmpty property="orderBy">
              <isEqual property="orderBy" compareValue="P">
                  LEFT JOIN (SELECT ESP.EVENT_ID
                                  , SUM(OP.ORDER_COUNT - OP.CANC_COUNT) CNT
                               FROM TB_ORDER O
                               JOIN TB_ORDER_PRODUCT OP ON O.ORDER_NUM = OP.ORDER_NUM AND OP.ORDER_PRDT_STAT_CODE = 'C0171'
                               JOIN TB_SELL_PRODUCT SP ON OP.SELL_PRDT_BCODE = SP.SELL_PRDT_BCODE AND SP.SELL_PRDT_GBN IN ('P', 'G', 'S') AND SP.PRMT_CODE = 'C0302' AND SP.PRDT_STAT_CODE = 'C0312'
                               JOIN TB_VENDOR_CONTRACT VC ON SP.VNDR_CNTRT_ID = VC.VNDR_CNTRT_ID AND TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN VC.CNTRT_START_DT AND VC.CNTRT_END_DT AND VC.VNDR_CNTRT_STAT_CODE = 'C0072'
                               JOIN TB_EVENT_SELL_PRODUCT ESP ON ESP.SELL_PRDT_BCODE = DECODE(SP.SELL_PRDT_GBN, 'S', SP.PRIME_SELL_PRDT_BCODE, SP.SELL_PRDT_BCODE)
                              WHERE O.ORDER_DTM BETWEEN TO_DATE(TO_CHAR(SYSDATE-7, 'YYYYMMDD')||'000000', 'YYYYMMDDHH24MISS') AND SYSDATE
                                AND O.MALL_ID = '02'
                                AND O.ORDER_STATUS_CODE != 'C0281'
                              GROUP BY ESP.EVENT_ID
                            ) T ON A.EVENT_ID = T.EVENT_ID
               </isEqual>
           </isNotEmpty>
         WHERE TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN A.EVENT_START_DT AND A.EVENT_END_DT
           AND A.EVENT_STAT_CODE = 'C0181'    /* 정상 */
           AND A.PRMT_CODE = 'C0374'          /* 승인완료 */
           AND A.EVENT_TYPE_CODE NOT IN ('C0196', 'C0198')    /* 오늘만특가,코멘트C,뮤직샵상품할인 */
           AND A.CTGR_ID LIKE #ctgrId#  || '%'
           AND A.DISP_YN = 'Y'
           AND FC_IS_VALID_EVENT(A.EVENT_ID, #mallId#) = 'Y'
           <isNotEmpty property="orderBy">
              <isEqual property="orderBy" compareValue="O">
              AND A.EVENT_END_DT BETWEEN TO_CHAR (SYSDATE, 'YYYYMMDD') AND TO_CHAR (SYSDATE + 3, 'YYYYMMDD')
              </isEqual>
		   </isNotEmpty>
         <dynamic>
            <isEmpty property="orderBy">ORDER BY A.EVENT_START_DT DESC</isEmpty>
            <isNotEmpty property="orderBy">
                <isEqual property="orderBy" compareValue="P">ORDER BY NVL(T.CNT, 0) DESC</isEqual>
                <isEqual property="orderBy" compareValue="O">ORDER BY A.EVENT_END_DT</isEqual>
            </isNotEmpty>
         </dynamic>
    </select>
    <!-- 
        작성자: 장진용
        작성일: 2014-08-05
        기능: 이벤트 상세 정보 반환
    -->
    <select id="getnewEventDispTypeCode" parameterClass="kr.co.hottracks.site.model.renewal.event.EventCriteria" resultClass="kr.co.hottracks.site.model.renewal.event.BizEventCriteria">
        /* FrontEventSQL.getEventDetail */ 
        SELECT A.NEW_EVENT_DISP_TYPE_CODE newEventDispTypeCode
          FROM TB_EVENT_MASTER A
         WHERE EVENT_ID = #eventId#
    </select>
</sqlMap>