<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="BizSellGiftSQL">                        
    <typeAlias alias="bizDispCriteria" type="kr.co.hottracks.site.model.common.disp.BizDispCriteria"/>
    <typeAlias alias="bizSellGiftCriteria" type="kr.co.hottracks.site.model.common.sellGift.BizSellGiftCriteria"/>
    <typeAlias alias="bizSellGiftExt" type="kr.co.hottracks.site.model.common.sellGift.BizSellGiftExt"/>    
	<typeAlias alias="bizSellMusicCriteria" type="kr.co.hottracks.site.model.common.sellMusic.BizSellMusicCriteria"/>
    <typeAlias alias="bizSellMusicExt" type="kr.co.hottracks.site.model.common.sellMusic.BizSellMusicExt"/>
    <typeAlias alias="wishPrdtOrBrandDto" type="kr.co.hottracks.site.model.frontoffice.mypage.WishPrdtOrBrandDto" />
    <typeAlias alias="wishProductParam" type="kr.co.hottracks.site.model.frontoffice.mypage.WishProductParam" />
    <typeAlias alias="sellGiftCriteria" type="kr.co.hottracks.site.model.common.sellGift.SellGiftCriteria"/>
    
    <!-- 
        작성자: 김정호
        작성일 : 2019-11-27
        기능 : 기프트상품목록반환
    -->
    <select id="getSellGiftList" parameterClass="bizDispCriteria" resultClass="bizSellGiftExt">
        /* BizSellGiftSQL.getSellGiftList */
        SELECT DP.SELL_PRDT_BCODE                           			sellPrdtBcode
             , FC_GET_PRDT_NAME(DP.SELL_PRDT_BCODE, '02')   			prdtName
             , DP.PRDT_SELL_PRICE                           			prdtSellPrice
             , DP.PRDT_SAVED_PRICE                          			prdtSavedPrice
             , DP.PRDT_SAVED_RATE                           			prdtSavedRate
             , DP.DLVY_VNDR_ID                              			dlvyVndrId
             , DP.PRDT_STAT_CODE                            			prdtStatCode
             , DP.NYO_SELL_BAN_YN                           			nyoSellBanYn
             , DP.SELL_PRDT_GBN											sellPrdtGbn
             , FC_GET_WISH_PRODUCT_COUNT(DP.SELL_PRDT_BCODE, '02')      wishPrdtCnt
             , FC_GET_REVIEW_PRODUCT_COUNT(DP.SELL_PRDT_BCODE, '02')    reviewCount
             , DP.BRAND_ID												brandId
             , FC_GET_DC_PRICE(DP.SELL_PRDT_BCODE, '02')                lastDcPrice
             , FC_GET_DC_RATE_MALL(DP.SELL_PRDT_BCODE, '02')            lastDcRate
             , FC_GET_CPN_PRICE(DP.SELL_PRDT_BCODE, '02')               lastCpnPrice
             , FC_GET_PRODUCT_ICON_CODE(DP.SELL_PRDT_BCODE, '02')       prdtIcon             
             , (SELECT NVL(B.BRAND_ENG_NAME, B.BRAND_NAME) FROM TB_BRAND B WHERE B.BRAND_ID = DP.BRAND_ID)                          brandName
             , (SELECT T.PRDT_IMAGE_URL FROM TB_PRODUCT_IMAGE T WHERE T.SELL_PRDT_BCODE = DP.SELL_PRDT_BCODE AND T.DISP_ORDER = 0)  productImageUrl
             , (SELECT T.PRDT_IMAGE_URL FROM TB_PRODUCT_IMAGE T WHERE T.SELL_PRDT_BCODE = DP.SELL_PRDT_BCODE AND T.DISP_ORDER = 1)  productImageUrl2                          
             , nvl((SELECT COUNT(1) FROM TB_WISH_PRODUCT T WHERE T.WISH_GBN = 'P' AND T.SELL_PRDT_BCODE = DP.SELL_PRDT_BCODE AND T.MALL_ID = '02' AND T.USER_NUM = #userNum#), 0)   wishUserPrdtCnt
             , DP.RCRD_STAT    rcrdStat
          FROM TB_DISPLAY_PRODUCT DP
          JOIN TB_PRODUCT_CATEGORY PC ON DP.SELL_PRDT_BCODE = PC.SELL_PRDT_BCODE AND PC.CTGR_ID LIKE #ctgrId# || '%'
          LEFT JOIN TB_DISPLAY_PRODUCT_SALE DPS ON DP.SELL_PRDT_BCODE = DPS.SELL_PRDT_BCODE AND DPS.MALL_ID = 02
         WHERE DP.SELL_PRDT_GBN IN ('P', 'G')
			<isEqual property="saleYn" compareValue="N">
       			AND DP.PRDT_STAT_CODE = 'C0312'
       		</isEqual>
       		<isEqual property="freeDlvYn" compareValue="Y">
               AND FC_GET_FREE_DLVY_YN_DISP(DP.SELL_PRDT_BCODE, '02') = #freeDlvYn#
       		</isEqual>
       		<isEqual property="hotDlvYn" compareValue="Y">
               AND DP.DLVY_VNDR_ID = '0625'
       		</isEqual>
       		<isEqual property="cpYn" compareValue="Y">
               AND FC_IS_COUPON_YN(DP.SELL_PRDT_BCODE, #mallId#) = #cpYn#
       		</isEqual>
       		<isEqual property="dcYn" compareValue="Y">
               AND FC_GET_DC_PRICE(DP.SELL_PRDT_BCODE, #mallId#) != DP.PRDT_SELL_PRICE
       		</isEqual>
       		<isEqual property="rsvYn" compareValue="Y">
               AND DP.RCRD_STAT = 9
       		</isEqual>
           <isNotEmpty property="brandId">
               AND DP.BRAND_ID = #brandId#
           </isNotEmpty>
         GROUP BY DP.SELL_PRDT_BCODE, DP.PRDT_SELL_PRICE, DP.PRDT_SAVED_PRICE, DP.PRDT_SAVED_RATE, DP.DLVY_VNDR_ID, DP.PRDT_STAT_CODE, DP.NYO_SELL_BAN_YN, DP.CLICK_COUNT, DP.WISH_COUNT, DP.REVIEW_COUNT, DP.BRAND_ID, NVL(DPS.SALE_CNT, 0), DP.PRMT_DTM, DP.RCRD_STAT, DP.SELL_PRDT_GBN
        <dynamic prepend="ORDER BY">
            <!-- R:최신순, P:인기순, L:낮은가격순, H:높은가격순 , B:브랜드 상품 베스트 -->
            <isEmpty property="productOrderBy">DP.PRMT_DTM DESC</isEmpty>
            <isNotEmpty property="productOrderBy">
                <isEqual property="productOrderBy" compareValue="R">DP.PRMT_DTM DESC NULLS LAST</isEqual>
                <isEqual property="productOrderBy" compareValue="P">NVL(DPS.SALE_CNT, 0) DESC, DP.CLICK_COUNT DESC, DP.WISH_COUNT DESC, DP.REVIEW_COUNT DESC, DP.PRMT_DTM DESC</isEqual>
                <isEqual property="productOrderBy" compareValue="L">FC_GET_CPN_PRICE(DP.SELL_PRDT_BCODE, #mallId#) ASC, DP.PRMT_DTM DESC</isEqual>
                <isEqual property="productOrderBy" compareValue="H">FC_GET_CPN_PRICE(DP.SELL_PRDT_BCODE, #mallId#) DESC, DP.PRMT_DTM DESC</isEqual>
                <isEqual property="productOrderBy" compareValue="T">FC_GET_LAST_DC_RATE(DP.SELL_PRDT_BCODE, #mallId#) DESC, DP.PRMT_DTM DESC</isEqual>
                <isEqual property="productOrderBy" compareValue="W">DP.WISH_COUNT DESC, DP.PRMT_DTM DESC</isEqual>
                <isEqual property="productOrderBy" compareValue="Q">DP.REVIEW_COUNT DESC, DP.PRMT_DTM DESC</isEqual>
                <isEqual property="productOrderBy" compareValue="B">
                NVL ((SELECT COUNT (*)
						FROM TB_ORDER_PRODUCT OP
					   WHERE OP.ORDER_PRDT_STAT_CODE = 'C0171'
						 AND OP.SELL_PRDT_BCODE = DP.SELL_PRDT_BCODE
						 AND OP.LAST_MOD_DTM BETWEEN SYSDATE -3 and SYSDATE
					 ),0
					) DESC,
                NVL ((SELECT COUNT (*)
						FROM TB_ORDER_PRODUCT OP
					   WHERE OP.ORDER_PRDT_STAT_CODE = 'C0171'
						 AND OP.SELL_PRDT_BCODE = DP.SELL_PRDT_BCODE
					 ),0
					) DESC,
                NVL(DPS.SALE_CNT, 0) DESC, 
                DP.CLICK_COUNT DESC, 
                DP.WISH_COUNT DESC, 
                DP.REVIEW_COUNT DESC, 
                DP.PRMT_DTM DESC</isEqual>
            </isNotEmpty>
        </dynamic>
    </select>
    
    <!-- 
        작성자: 김정호
        작성일 : 2019-11-27
        기능 : 카테고리별 상품 목록 수 반환
    -->
    <select id="countSellGiftList" parameterClass="bizSellGiftCriteria" resultClass="int">
        /* BizSellGiftSQL.countSellGiftList */
        SELECT COUNT(1) as CNT
          FROM (SELECT 1
                  FROM TB_DISPLAY_PRODUCT DP
                  JOIN TB_PRODUCT_CATEGORY PC ON DP.SELL_PRDT_BCODE = PC.SELL_PRDT_BCODE AND PC.CTGR_ID LIKE #ctgrId# || '%'
                 WHERE DP.SELL_PRDT_GBN IN ('P', 'G')
	           		<isEqual property="saleYn" compareValue="N">
	           			AND DP.PRDT_STAT_CODE = 'C0312'
	           		</isEqual>
	           		<isEqual property="freeDlvYn" compareValue="Y">
	                   AND FC_GET_FREE_DLVY_YN_DISP(DP.SELL_PRDT_BCODE, '02') = #freeDlvYn#
	           		</isEqual>
	           		<isEqual property="hotDlvYn" compareValue="Y">
	                   AND DP.DLVY_VNDR_ID = '0625'
	           		</isEqual>
	           		<isEqual property="cpYn" compareValue="Y">
	                   AND FC_IS_COUPON_YN(DP.SELL_PRDT_BCODE, #mallId#) = #cpYn#
	           		</isEqual>
	           		<isEqual property="dcYn" compareValue="Y">
	                   AND FC_GET_DC_PRICE(DP.SELL_PRDT_BCODE, #mallId#) != DP.PRDT_SELL_PRICE
	           		</isEqual>
	           		<isEqual property="rsvYn" compareValue="Y">
	                   AND DP.RCRD_STAT = 9
	           		</isEqual>
	           		<isNotEmpty property="brandId">
		               AND DP.BRAND_ID = #brandId#
		            </isNotEmpty>
                 GROUP BY DP.SELL_PRDT_BCODE
               )
         WHERE ROWNUM &lt; #topCount# + 1
    </select>
    
    <!-- 
        작성자: 김정호
        작성일 : 2019-11-27
        기능 : 카테고리별 총 상품 목록 수 반환
    -->
    <select id="totalSellGiftList" parameterClass="bizDispCriteria" resultClass="int">
        /* SellGiftSQL.totalSellGiftList */
        SELECT COUNT(1) as CNT
          FROM (SELECT 1
                  FROM TB_DISPLAY_PRODUCT DP
                  JOIN TB_PRODUCT_CATEGORY PC ON DP.SELL_PRDT_BCODE = PC.SELL_PRDT_BCODE AND PC.CTGR_ID LIKE #ctgrId# || '%'
                 WHERE DP.SELL_PRDT_GBN IN ('P', 'G')
	           		<isEqual property="saleYn" compareValue="N">
	                   AND DP.PRDT_STAT_CODE = 'C0312'
	           		</isEqual>
	           		<isEqual property="freeDlvYn" compareValue="Y">
	                   AND FC_GET_FREE_DLVY_YN_DISP(DP.SELL_PRDT_BCODE, '02') = #freeDlvYn#
	           		</isEqual>
	           		<isEqual property="hotDlvYn" compareValue="Y">
	                   AND DP.DLVY_VNDR_ID = '0625'
	           		</isEqual>
	           		<isEqual property="cpYn" compareValue="Y">
	                   AND FC_IS_COUPON_YN(DP.SELL_PRDT_BCODE, #mallId#) = #cpYn#
	           		</isEqual>
	           		<isEqual property="dcYn" compareValue="Y">
	                   AND FC_GET_DC_PRICE(DP.SELL_PRDT_BCODE, #mallId#) != DP.PRDT_SELL_PRICE
	           		</isEqual>
	           		<isEqual property="rsvYn" compareValue="Y">
	                   AND FC_GET_DC_PRICE(DP.SELL_PRDT_BCODE, #mallId#) != DP.PRDT_SELL_PRICE
	           		</isEqual>
		            <isNotEmpty property="brandId">
		                AND DP.BRAND_ID = #brandId#
		            </isNotEmpty>
                 GROUP BY DP.SELL_PRDT_BCODE
               )         
    </select>
    
    <!-- 
        작성자: 김정호
        작성일 : 2019-11-27
        기능 : 상품리스트
    -->
    <select id="getBizSellMusicList" parameterClass="bizSellMusicCriteria" resultClass="bizSellMusicExt">
        /* BizSellGiftSQL.getBizSellMusicList */      	 
        SELECT A.RCRD_CD                        rcrdCd
             , A.SELL_PRDT_BCODE                sellPrdtBcode
             , B.PRVD_TITLE                     prvdTitle
             , CASE WHEN TO_CHAR(SYSDATE, 'YYYYMMDD') &lt;= B.SUB_COMMENTS_END_DT THEN B.RCRD_SUB_COMMENTS END              rcrdSubComments
             , B.SELL_PRDT_GBN                  sellPrdtGbn
             , C.RCRD_NAME                      rcrdName
             , NVL(B.PRVD_TITLE, B.PRDT_NAME)   commTitle
             , C.ARTI_NAME                      artiName
             , (SELECT T.MAKER_NAME FROM TB_REC_MAKER T WHERE T.MAKER_CD = C.MAKER_CD)  makerName
             , C.RLSE_DT                        rlseDt
             , FC_REC_GET_SALE_YN(A.STOCK_CNT_PRODUCT, B.RCRD_STAT, B.RCRD_HARD_SALE_YN, B.RCRD_LSALE_START_DTH, B.RCRD_LSALE_END_DTH, B.LAVE_COUNT)  saleYn
             , FC_REC_GET_STOCK_MAIL_YN(A.STOCK_CNT_PRODUCT, B.RCRD_STAT, B.RCRD_HARD_SALE_YN, B.RCRD_LSALE_START_DTH, B.RCRD_LSALE_END_DTH)            outOfStockMailYn
             , B.PRDT_SELL_PRICE                prdtSellPrice
             , FC_GET_DC_PRICE (A.SELL_PRDT_BCODE, '02')    lastDcPrice
             , B.PRDT_SAVED_RATE                prdtSavedRate
             , B.RCRD_STAT                      rcrdStat
             , B.RCRD_RLSE_INFO                 rcrdRlseInfo
             , FC_GET_REVIEW_COUNT('02', A.RCRD_CD)         reviewCount
             , FC_GET_REVIEW_GRADE('02', A.RCRD_CD)         reviewGrade
             , C.RTNG_CODE                      rtngCode
             , C.IMP_YN                         impYn
             , C.OKDATE                         okdate
             , C.PRODUCTION_NATION              productionNation
             , listSize
             , nvl((SELECT COUNT(1) FROM TB_WISH_PRODUCT TP WHERE TP.WISH_GBN = 'P' AND TP.SELL_PRDT_BCODE =  A.SELL_PRDT_BCODE AND TP.MALL_ID = '02' AND TP.USER_NUM = #userNum#), 0)                wishUserPrdtCnt
             , FC_GET_PRODUCT_ICON_CODE(A.SELL_PRDT_BCODE, '02')       prdtIcon
             , DECODE((SELECT COUNT(*) FROM TB_POSTER_CASE A WHERE TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN A.PRSNT_START_DAY AND PRSNT_END_DAY AND A.SELL_PRDT_BCODE = B.SELL_PRDT_BCODE), '0', 'N', 'Y')     hasPosterCaseYn
             , A.MEDIA_NAME 					mediaName
             <isNotEmpty property="ctgrId">
             , #ctgrId#  ctgrId
             </isNotEmpty>
        FROM (
           SELECT T.*
                , ROWNUM NO
                , SUM(CASE WHEN ROWNUM &lt; #topCount#+1 THEN 1 ELSE 0 END) OVER() listSize
             FROM (SELECT SP.SELL_PRDT_BCODE
                        , SP.RCRD_CD
                        , RPSL.STOCK_CNT_PRODUCT                        
                        , RM.MEDIA_NAME                        
                     FROM TB_SELL_PRODUCT SP
                    INNER JOIN TB_RECORD R ON SP.RCRD_CD = R.RCRD_CD AND R.DISP_YN = 'Y'                    
                    INNER JOIN TB_REC_PROD_STOCK_LAST RPSL ON SP.SELL_PRDT_BCODE = RPSL.SELL_PRDT_BCODE
                    LEFT OUTER JOIN TB_REC_MEDIA RM ON R.MEDIA_CD = RM.MEDIA_CD
                    WHERE (   SP.RCRD_HARD_SALE_YN = 'Y'
                           OR TO_CHAR(SYSDATE, 'YYYYMMDDHH24') BETWEEN NVL(SP.RCRD_LSALE_START_DTH, '9999999999') AND NVL(SP.RCRD_LSALE_END_DTH, '0000000000')
                           OR DECODE(RPSL.STOCK_CNT_RECORD, 0, DECODE(SP.SELL_PRDT_BCODE, R.SELL_PRDT_BCODE, 'Y', 'N'), DECODE(RPSL .STOCK_CNT_PRODUCT, 0, 'N', 'Y')) = 'Y'
                          )
                      AND SP.SELL_PRDT_GBN IN ('R', 'D')
                      AND SP.SELL_PRDT_BCODE NOT IN (SELECT SELL_PRDT_BCODE FROM TB_EXP_PRODUCT)
                      AND SP.SELL_PRDT_BCODE NOT IN ('2300185905250' , '2300185905243')
	                    <isNotEmpty property="ctgrId" prepend="AND">
	                          EXISTS (SELECT 1 FROM TB_PRODUCT_CATEGORY T1 WHERE T1.CTGR_ID LIKE #ctgrId#||'%' AND T1.SELL_PRDT_BCODE = SP.SELL_PRDT_BCODE)
	                    </isNotEmpty>
	                    <isEqual property="saleYn" compareValue="N" prepend="AND">
	                         FC_REC_GET_SALE_YN(RPSL.STOCK_CNT_PRODUCT, SP.RCRD_STAT, SP.RCRD_HARD_SALE_YN, SP.RCRD_LSALE_START_DTH, SP.RCRD_LSALE_END_DTH, SP.LAVE_COUNT) = 'Y' 
	                    </isEqual>                    
			          	<isEqual property="freeDlvYn" compareValue="Y">
			            	AND FC_GET_FREE_DLVY_YN_DISP(SP.SELL_PRDT_BCODE, '02') = #freeDlvYn#
			           	</isEqual>
			          	<isEqual property="hotDlvYn" compareValue="Y">
			            	AND SP.DLVY_VNDR_ID = '0625'
			           	</isEqual>
			          	<isEqual property="cpYn" compareValue="Y">
			            	AND FC_IS_COUPON_YN(SP.SELL_PRDT_BCODE, #mallId#) = #cpYn#
			           	</isEqual>
			          	<isEqual property="dcYn" compareValue="Y">
			            	AND FC_GET_DC_PRICE(SP.SELL_PRDT_BCODE, #mallId#) != SP.PRDT_SELL_PRICE
			           	</isEqual>
			           	<isEqual property="rsvYn" compareValue="Y">
			            	AND SP.RCRD_STAT = 9
			           	</isEqual>
                <dynamic prepend="ORDER BY">
                    <isEmpty property="productOrderBy">SP.PRMT_DTM DESC</isEmpty>
                    <isNotEmpty property="productOrderBy">
                        <isEqual property="productOrderBy" compareValue="R">SP.PRMT_DTM DESC</isEqual>
                        <isEqual property="productOrderBy" compareValue="P">SP.SALE_CNT_WEEK DESC</isEqual>
                        <isEqual property="productOrderBy" compareValue="L">FC_GET_DC_PRICE(SP.SELL_PRDT_BCODE, '02') ASC</isEqual>
                        <isEqual property="productOrderBy" compareValue="H">FC_GET_DC_PRICE(SP.SELL_PRDT_BCODE, '02') DESC</isEqual>
                        <isEqual property="productOrderBy" compareValue="T">FC_GET_LAST_DC_RATE(SP.SELL_PRDT_BCODE, #mallId#) DESC, SP.PRMT_DTM DESC</isEqual>
                    </isNotEmpty>
                </dynamic>
                  ) T
        ) A
        JOIN TB_SELL_PRODUCT B ON A.SELL_PRDT_BCODE = B.SELL_PRDT_BCODE 
        JOIN TB_RECORD C ON A.RCRD_CD = C.RCRD_CD 
        WHERE NO BETWEEN #fetchScale# + 1 AND #maxRownum#
        ORDER BY NO   
    </select>
    
    <!-- 
        작성자: 김정호
        작성일 : 2019-11-27
        기능 : 상품리스트
    -->
    <select id="totalBizSellMusicList" parameterClass="bizSellMusicCriteria" resultClass="int">
        /* BizSellGiftSQL.totalBizSellMusicList */      	 
        SELECT 
        	COUNT(1) as CNT
        FROM (
           SELECT 1
             FROM (SELECT SP.SELL_PRDT_BCODE
                        , SP.RCRD_CD
                        , RPSL.STOCK_CNT_PRODUCT 
                     FROM TB_SELL_PRODUCT SP
                    INNER JOIN TB_RECORD R ON SP.RCRD_CD = R.RCRD_CD AND R.DISP_YN = 'Y'
                    INNER JOIN TB_REC_PROD_STOCK_LAST RPSL ON SP.SELL_PRDT_BCODE = RPSL.SELL_PRDT_BCODE
                    WHERE (   SP.RCRD_HARD_SALE_YN = 'Y'
                           OR TO_CHAR(SYSDATE, 'YYYYMMDDHH24') BETWEEN NVL(SP.RCRD_LSALE_START_DTH, '9999999999') AND NVL(SP.RCRD_LSALE_END_DTH, '0000000000')
                           OR DECODE(RPSL.STOCK_CNT_RECORD, 0, DECODE(SP.SELL_PRDT_BCODE, R.SELL_PRDT_BCODE, 'Y', 'N'), DECODE(RPSL .STOCK_CNT_PRODUCT, 0, 'N', 'Y')) = 'Y'
                          )
                      AND SP.SELL_PRDT_GBN IN ('R', 'D')
                      AND SP.SELL_PRDT_BCODE NOT IN (SELECT SELL_PRDT_BCODE FROM TB_EXP_PRODUCT)
                      AND SP.SELL_PRDT_BCODE NOT IN ('2300185905250' , '2300185905243')
	                    <isNotEmpty property="ctgrId" prepend="AND">
	                          EXISTS (SELECT 1 FROM TB_PRODUCT_CATEGORY T1 WHERE T1.CTGR_ID LIKE #ctgrId#||'%' AND T1.SELL_PRDT_BCODE = SP.SELL_PRDT_BCODE)
	                    </isNotEmpty>
	                    <isEqual property="saleYn" compareValue="N" prepend="AND">
	                         FC_REC_GET_SALE_YN(RPSL.STOCK_CNT_PRODUCT, SP.RCRD_STAT, SP.RCRD_HARD_SALE_YN, SP.RCRD_LSALE_START_DTH, SP.RCRD_LSALE_END_DTH, SP.LAVE_COUNT) = 'Y' 
	                    </isEqual>                    
						<isEqual property="freeDlvYn" compareValue="Y">
						 	AND FC_GET_FREE_DLVY_YN_DISP(SP.SELL_PRDT_BCODE, '02') = #freeDlvYn#
							</isEqual>
						<isEqual property="hotDlvYn" compareValue="Y">
						 	AND SP.DLVY_VNDR_ID = '0625'
							</isEqual>
						<isEqual property="cpYn" compareValue="Y">
						 	AND FC_IS_COUPON_YN(SP.SELL_PRDT_BCODE, #mallId#) = #cpYn#
							</isEqual>
						<isEqual property="dcYn" compareValue="Y">
						 	AND FC_GET_DC_PRICE(SP.SELL_PRDT_BCODE, #mallId#) != SP.PRDT_SELL_PRICE
						</isEqual>
						<isEqual property="rsvYn" compareValue="Y">
					 		AND SP.RCRD_STAT = 9
						</isEqual>
                  ) T
        ) A                 
    </select>       
         
	<select id="getPrdtCntByCtgrForBrand" parameterClass="bizDispCriteria" resultClass="bizSellGiftExt">
        /* BizSellGiftSQL.getPrdtCntByCtgrForBrand */
        SELECT V.CTGR_ID                ctgrId
             , NVL(C.CTGR_NAME, '전체')  ctgrName
             , CNT                      productCnt
          FROM (SELECT ''       CTGR_ID
                     , SUM(CNT) CNT
                  FROM (SELECT SUBSTR(PC.CTGR_ID, 0, 6)
		                     , COUNT(DISTINCT SG.SELL_PRDT_BCODE) CNT
		                  FROM TB_DISPLAY_PRODUCT SG
		                  JOIN TB_PRODUCT_CATEGORY PC ON SG.SELL_PRDT_BCODE = PC.SELL_PRDT_BCODE
		                 WHERE SG.SELL_PRDT_GBN IN ('P', 'G')
		                   AND SG.BRAND_ID = #brandId#
							<isEqual property="saleYn" compareValue="N" prepend="AND">
                       		   SG.PRDT_STAT_CODE = 'C0312' 
							</isEqual>
		                   AND NOT EXISTS (SELECT 1 FROM TB_CATEGORY SA WHERE PC.CTGR_ID LIKE SA.CTGR_ID||'%' AND SA.USE_YN = 'N')
		                 GROUP BY SUBSTR(PC.CTGR_ID, 0, 6)
                  	   )
                UNION ALL
                SELECT SUBSTR(PC.CTGR_ID, 0, 6)
                     , COUNT(DISTINCT SG.SELL_PRDT_BCODE) CNT
                  FROM TB_DISPLAY_PRODUCT SG
                  JOIN TB_PRODUCT_CATEGORY PC ON SG.SELL_PRDT_BCODE = PC.SELL_PRDT_BCODE
                 WHERE SG.SELL_PRDT_GBN IN ('P', 'G')
                   AND SG.BRAND_ID = #brandId#
					<isEqual property="saleYn" compareValue="N" prepend="AND">
                       SG.PRDT_STAT_CODE = 'C0312' 
					</isEqual>
                   AND NOT EXISTS (SELECT 1 FROM TB_CATEGORY SA WHERE PC.CTGR_ID LIKE SA.CTGR_ID||'%' AND SA.USE_YN = 'N')
                 GROUP BY SUBSTR(PC.CTGR_ID, 0, 6)
          )V
          LEFT OUTER JOIN TB_CATEGORY C ON V.CTGR_ID = C.CTGR_ID
         ORDER BY NVL(C.DISP_ORDER, 0)
    </select>    
    
    <!--  
	작성자: DD
	작성일 : 2019.11.28
	기능 : 상품 좋아요 수(단건)  
	-->
    <select id="countWishProduct" resultClass="int" parameterClass="String">
        /* BizSellGiftSQL.countWishProduct */
        SELECT COUNT(*) AS CNT
          FROM TB_WISH_PRODUCT
         WHERE WISH_GBN = 'P' 
         AND MALL_ID = '02' 
         AND SELL_PRDT_BCODE = #value#
    </select>  
    
    <!--  
	작성자: DD
	작성일 : 2019.12.06
	기능 : 브랜드 좋아요 수(단건)  
	-->
    <select id="countWishBrand" resultClass="int" parameterClass="String">
        /* BizSellGiftSQL.countWishBrand */
        SELECT COUNT(*) AS CNT
          FROM TB_WISH_PRODUCT
         WHERE WISH_GBN = 'B' 
         AND MALL_ID = '02' 
         AND BRAND_ID = #value#
    </select>
    
    <!--  
        작성자 : 김정호
        작성일자 : 2020-01-09
        기능 : 좋아요 이럴 때, 삭제
     -->
    <delete id="deleteWishLife" parameterClass="wishProductParam">
       /* BizSellGiftSQL.deleteWishLife */
        DELETE FROM TB_WISH_PRODUCT
        WHERE SVC_SEQ = #barcode#
          AND USER_NUM = #userNum#
          AND WISH_GBN = 'L'
          AND MALL_ID = #mallId#
    </delete>
    
    <!--  
	작성자: 김정호
	작성일 : 2020.01.09
	기능 : 이럴 때, 좋아요 수  
	-->
    <select id="countWishLife" resultClass="int" parameterClass="String">
        /* BizSellGiftSQL.countWishLife */
        SELECT COUNT(*) AS CNT
          FROM TB_WISH_PRODUCT
         WHERE WISH_GBN = 'L' 
         AND MALL_ID = '02' 
         AND SVC_SEQ = #value#
    </select>
    
    <!--  
        작성자 : 김정호
        작성일자 : 2020-01-09
        기능 : 좋아요 이럴 때, 추가
     -->       
    <insert id="addWishLife" parameterClass="wishPrdtOrBrandDto">
        <selectKey keyProperty="wishSeq" resultClass="int" type="pre">
        SELECT
            wish_prdt_seq.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO tb_wish_product (
        user_num,
        wish_prdt_seq,
        regst_dtm,
        wish_gbn,        
        strg_alt_yn,
        recv_gbn,
        mall_id,
        svc_seq
        ) VALUES (
        #userNum#,
        #wishSeq#,
        SYSDATE,
        #wishGbn#,        
        #strgAltYn#,
        #recvGbn#,
        #mallId#,
        #barcode#
        )
    </insert>    
</sqlMap>