<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="BrandSQL">
    <typeAlias alias="brand" type="kr.co.hottracks.site.model.common.vendor.Brand"/>
    <typeAlias alias="brandParam" type="kr.co.hottracks.site.model.common.vendor.BrandParam"/>
    <typeAlias alias="brandCriteria" type="kr.co.hottracks.site.model.common.vendor.BrandCriteria"/>
    <typeAlias alias="brandImageParam" type="kr.co.hottracks.site.model.common.vendor.BrandImageParam"/>
    <typeAlias alias="brandMainCriteria" type="kr.co.hottracks.site.model.frontoffice.brand.BrandMainCriteria"/>
    <typeAlias alias="simpleBrandDto" type="kr.co.hottracks.site.model.frontoffice.brand.SimpleBrandDto"/>
	<typeAlias alias="displayCriteria" type="kr.co.hottracks.site.model.common.display.DisplayCriteria"/>
    
    <sql id="getBrandListWhere">
        <isNotEmpty property="brandId" prepend="AND" removeFirstPrepend="true">
            BRAND_ID = #brandId#
        </isNotEmpty>
        <isNotEmpty property="brandName" prepend="AND" removeFirstPrepend="true">
           (BRAND_NAME LIKE UPPER(#brandName#||'%') OR BRAND_NAME LIKE LOWER(#brandName#||'%'))
        </isNotEmpty>
        <isNotEmpty property="displayYn" prepend="AND" removeFirstPrepend="true">
            BRAND_DISP_YN = #displayYn#
        </isNotEmpty>
        <isNotEmpty property="displayCategoryId" prepend="AND" removeFirstPrepend="true">
            DISP_CTGR_ID like #displayCategoryId#||'%'
        </isNotEmpty>
    </sql>
    
    <select id="getBrandByBrandId" parameterClass="string" resultClass="brandParam">
        /*BrandSQL.getBrandByBrandId*/
        SELECT BRAND_ID            brandId
             , BRAND_NAME        brandName
             , BRAND_ENG_NAME    englishName
             , BRAND_SMRY        summary
             , BRAND_DESC        description
             , BRAND_DISP_YN     displayYn
             , REGST_ADMIN_ID    registAdminId
             , REGST_DTM         registDate
             , DISP_CTGR_ID      displayCategoryId
             , MNGR_MD_ID        managerMdId
             , HAN_GBN_CODE      hanGubunCode
             , ENG_GBN_CODE      engGubunCode
             , FC_GET_MALLID_BRAND(BRAND_ID) mallId
          FROM TB_BRAND
         WHERE BRAND_ID = #brandId#
    </select>
    
    <select id="getBrandByBrandIdForDisp" parameterClass="displayCriteria" resultClass="brandParam">
        /*BrandSQL.getBrandByBrandIdForDisp*/
        SELECT BRAND_ID            brandId
             , BRAND_NAME        brandName
             , BRAND_ENG_NAME    englishName
             , BRAND_SMRY        summary
             , BRAND_DESC        description
             , BRAND_DISP_YN     displayYn
             , REGST_ADMIN_ID    registAdminId
             , REGST_DTM         registDate
             , DISP_CTGR_ID      displayCategoryId
             , MNGR_MD_ID        managerMdId
             , HAN_GBN_CODE      hanGubunCode
             , ENG_GBN_CODE      engGubunCode
          FROM TB_BRAND
         WHERE BRAND_ID = #srchBrandId#
           <isNotEmpty property="mallId" prepend="AND">
               BRAND_ID IN (SELECT BRAND_ID FROM TB_MALL_BRAND WHERE MALL_ID = #mallId#)
           </isNotEmpty>
    </select>
    
    <sql id="getSearchBrandListFrom">
        FROM tb_brand A
        LEFT JOIN TB_VENDOR_CONTRACT B ON B.BRAND_ID = A.BRAND_ID
        LEFT JOIN TB_VENDOR C ON C.VNDR_ID = B.VNDR_ID
       WHERE A.BRAND_ID IN (SELECT D.BRAND_ID FROM TB_MALL_BRAND D WHERE D.MALL_ID IN ($mallIdUsingSql$))
        <isNotEmpty prepend="AND" property="contractStatusCode">
            B.VNDR_CNTRT_STAT_CODE  = #contractStatusCode#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="displayCategoryId">
            (A.DISP_CTGR_ID LIKE #displayCategoryId#||'%' OR #displayCategoryId# = '00')
        </isNotEmpty>
        <isEqual prepend="AND" property="searchKey" compareValue="brandId">
            A.BRAND_ID = #searchVal#
        </isEqual>
        <isEqual prepend="AND"  property="searchKey" compareValue="brandName">
            (A.BRAND_Name LIKE UPPER(#searchVal#)||'%' OR A.BRAND_Name LIKE LOWER(#searchVal#)||'%')
        </isEqual>
        <isEqual prepend="AND" property="searchKey" compareValue="vendorName">
            (C.VNDR_NAME LIKE UPPER(#searchVal#)||'%' OR C.vndr_name LIKE LOWER(#searchVal#)||'%')
        </isEqual>
                <isEqual prepend="AND" property="searchType" compareValue="hot">
            A.BRAND_ID IN (SELECT BRAND_ID FROM TB_CATEGORY_DISPLAY_ENTITY WHERE DISP_MSTR_ID = 'BRAND_HOT')
        </isEqual>
        <isEqual prepend="AND" property="searchType" compareValue="new">
            A.BRAND_ID IN (SELECT BRAND_ID FROM TB_CATEGORY_DISPLAY_ENTITY WHERE DISP_MSTR_ID = 'BRAND_NEW')
        </isEqual>
        <isNotEmpty prepend="AND" property="topCategoryGbn">
            DISP_CTGR_ID LIKE #topCategoryGbn#||'%'
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="vndrId">
            C.VNDR_ID = #vndrId#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="brandId">
            A.BRAND_ID = #brandId#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="brandName">
            A.BRAND_NAME LIKE '%'||UPPER(#brandName#)||'%'
        </isNotEmpty>
    </sql>
    
    <select id="getSearchBrandList" parameterClass="brandCriteria" resultClass="brandParam">
        /*BrandSQL.getSearchBrandList*/
        SELECT A.BRAND_ID           brandId
             , A.BRAND_NAME         brandName
             , C.VNDR_NAME          vendorName
             , B.VNDR_CNTRT_ID      vndrCntrtId
             , A.REGST_DTM          registDate
             , (SELECT BRAND_IMAGE_URL FROM TB_BRAND_IMAGE WHERE BRAND_IMAGE_CODE = 'C0292' AND BRAND_ID = A.BRAND_ID)  brandListImageUrl
             , (SELECT CTGR_NAME FROM TB_CATEGORY WHERE CTGR_ID = A.DISP_CTGR_ID)                                       displayCategoryName
          <include refid="getSearchBrandListFrom"/>
         ORDER BY A.REGST_DTM DESC
    </select>
    
    <select id="getSearchBrandListCount" parameterClass="brandCriteria" resultClass="int">
        /*BrandSQL.getSearchBrandListCount*/
        SELECT COUNT(A.BRAND_ID)
          <include refid="getSearchBrandListFrom"/>
           AND ROWNUM <![CDATA[ < ]]> #topCount# + 1
    </select>
    
    <select id="getListBrandImageByBrandId" parameterClass="string" resultClass="brandImageParam">
        /* BrandSQL.getListBrandImageByBrandId */
        SELECT BRAND_IMAGE_INSEQ    brandImageInseq
             , BRAND_ID             brandId
             , BRAND_IMAGE_CODE     brandImageCode
             , BRAND_IMAGE_URL      brandImageUrl
          FROM TB_BRAND_IMAGE
         WHERE BRAND_ID = #brandId#
         ORDER BY BRAND_IMAGE_INSEQ
    </select>
    
    <select id="selectSimpleBrandRow" parameterClass="brandMainCriteria" resultClass="simpleBrandDto">
        /* BrandSQL.selectSimpleBrandRow */
        SELECT brand.brand_id               id
             , brand.brand_name             koreanName
             , brand.brand_eng_name         englishName
             , brand.brand_smry             summary
             , brand.brand_desc             description
             , brandImage.brand_image_url   imageUrl
          FROM tb_brand brand
             , tb_brand_image brandImage
         WHERE brand.brand_id = brandImage.brand_id(+)
           <isNotEmpty property="brandId" prepend="AND">
               brand.brand_id = #brandId#
           </isNotEmpty>
           <isNotEmpty property="brandImageCode" prepend="AND">
               brandImage.brand_image_code(+) = #brandImageCode#
           </isNotEmpty>
           <isEmpty property="brandImageCode" prepend="AND">
               ROWNUM = 1
           </isEmpty>
           <isNotEmpty property="categoryCode" prepend="AND">
               brand.disp_ctgr_id = #categoryCode#
           </isNotEmpty>
           <isNotEmpty property="koreanCode" prepend="AND">
               brand.han_gbn_code = #koreanCode#
           </isNotEmpty>
           <isNotEmpty property="englishCode" prepend="AND">
               brand.eng_gbn_code = #englishCode#
           </isNotEmpty>
    </select>
    
    <select id="selectSimpleBrandListWithoutImage" parameterClass="brandMainCriteria" resultClass="simpleBrandDto">
        /* BrandSQL.selectSimpleBrandListWithoutImage */
        SELECT BRAND.BRAND_ID           id
             , BRAND.BRAND_NAME         koreanName
             , BRAND.BRAND_ENG_NAME     englishName
             , BRAND.BRAND_SMRY         summary
             , BRAND.BRAND_DESC         description
          FROM TB_BRAND BRAND
          JOIN TB_MALL_BRAND MALLBRAND ON BRAND.BRAND_ID = MALLBRAND.BRAND_ID AND MALLBRAND.MALL_ID = #mallId#
         WHERE BRAND.BRAND_DISP_YN = 'Y'
           AND BRAND.BRAND_ID IN (SELECT BRAND_ID FROM TB_VENDOR_CONTRACT WHERE TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN CNTRT_START_DT AND CNTRT_END_DT AND VNDR_CNTRT_STAT_CODE = 'C0072')
           <isNotEmpty property="brandId" prepend="AND">
               BRAND.BRAND_ID = #brandId#
           </isNotEmpty>
           <isNotEmpty property="categoryCode" prepend="AND">
               BRAND.DISP_CTGR_ID LIKE #categoryCode# || '%'
           </isNotEmpty>
           <isNotEmpty property="koreanCode" prepend="AND">
               FC_GET_CODE_NAME(#koreanCode#) = FC_INITKEYWORD(BRAND.BRAND_NAME)
           </isNotEmpty>
           <isNotEmpty property="englishCode" prepend="AND">
               FC_GET_CODE_NAME(#englishCode#) = FC_INITKEYWORD(BRAND.BRAND_ENG_NAME) AND TRIM(BRAND.BRAND_ENG_NAME) IS NOT NULL
           </isNotEmpty>
           <isNotEmpty property="searchStr">
               <isEqual property="isEnglish" compareValue="true" prepend="AND">
                   (UPPER(BRAND.BRAND_ENG_NAME) LIKE #searchStr# || '%' OR LOWER(BRAND.BRAND_ENG_NAME) LIKE #searchStr# || '%')
               </isEqual>
               <isEqual property="isEnglish" compareValue="false" prepend="AND">
                    BRAND.BRAND_NAME LIKE #searchStr# || '%'
               </isEqual>
           </isNotEmpty>
        <isEmpty property="koreanCode">
            <isEmpty property="englishCode">
                ORDER BY UPPER(BRAND.BRAND_NAME)
            </isEmpty>
        </isEmpty>
        <isNotEmpty property="koreanCode">ORDER BY UPPER(BRAND.BRAND_NAME)</isNotEmpty>
        <isNotEmpty property="englishCode">ORDER BY UPPER(BRAND.BRAND_ENG_NAME)</isNotEmpty>
    </select>
</sqlMap>