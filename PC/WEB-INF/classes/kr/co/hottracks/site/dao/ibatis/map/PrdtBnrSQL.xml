<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="PrdtBnrSQL">
    <typeAlias alias="prdtBnrExt" type="kr.co.hottracks.site.model.common.disp.PrdtBnrExt"/>
    
    <!-- 
        작성자: 권동희
        작성일: 2017-02-16
        기능: 상품 상세 배너 관리 페이지 및 상품문의 구분 값 넣기
     -->
    <select id="getPrdtBnrList" resultClass="prdtBnrExt" parameterClass="string">
        /* PrdtBnrSQL.getPrdtBnrList */
        SELECT *
          FROM (SELECT IMG_URL      imgUrl
                     , LINK_URL     linkUrl
                  FROM TB_PRDT_BNR T
                 WHERE SITE_GBN in ('A', 'P', 'H')
                   AND DISP_YN = 'Y'
                   AND TO_CHAR(SYSDATE,'YYYYMMDD') BETWEEN DISP_START_DT AND DISP_END_DT
                   AND EXISTS(SELECT 1
                                FROM TB_SELL_PRODUCT SP
                               WHERE 1 = 1
                                 AND CASE WHEN T.CTGR_ID = '0003' AND (FC_GET_PRDT_CTGR_ID(SP.SELL_PRDT_BCODE) LIKE '0003%' OR FC_GET_PRDT_CTGR_ID(SP.SELL_PRDT_BCODE) LIKE '0004%') THEN 'Y'
                                          WHEN T.CTGR_ID = '00' THEN 'Y'  
                                          WHEN FC_GET_PRDT_CTGR_ID(SP.SELL_PRDT_BCODE) LIKE T.CTGR_ID || '%' THEN 'Y'
                                          ELSE 'N'
                                      END = 'Y'
                                 AND NVL(T.DLVY_VNDR_ID, SP.DLVY_VNDR_ID) = SP.DLVY_VNDR_ID
                                 AND SP.SELL_PRDT_BCODE = #sellPrdtBcode#
                             )
                 ORDER BY DISP_ORDER, BNR_SEQ DESC
               )
         WHERE ROWNUM &lt; 3
    </select>
</sqlMap>