<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="ZipcodeSQL">
    <typeAlias alias="zipcode" type="kr.co.hottracks.site.model.common.Zipcode"/>
    <typeAlias alias="zipcodeCriteria" type="kr.co.hottracks.site.model.common.ZipcodeCriteria"/>

    <select id="getZipcodeList" resultClass="zipcode" parameterClass="zipcodeCriteria">
        /* ZipcodeSQL.getZipcodeList */
        SELECT POST_NUM_SEQ postNumSeq
             , SUBSTR(POST_NUM,1,3) || '-' || SUBSTR(POST_NUM,4,3)  postNum
             , SI           si
             , GU           gu
             , DONG         dong
             , RI           ri
             , DOSEO        doseo
             , BUNGI        bungi
             , BLDG_NAME    bldgName
             , ADDR         addr
          FROM TB_POST_NUM
         <dynamic prepend="WHERE">
             <isNotEmpty property="dong">
                 TRIM(DONG) like  #dongPrefix# || '%' OR TRIM(RI) like  #dongPrefix# || '%'
             </isNotEmpty>
         </dynamic>
         ORDER BY SI
    </select>
    
    <select id="getZipcodeList2" resultClass="zipcode" parameterClass="zipcodeCriteria">
        select /*+ RULE */
               substr(C.ZIP_CODE,1,3) || '-' || substr(C.ZIP_CODE,4,3) postNum
             , C.SI_DO_NAME si
             , C.SI_GU_NAME gu
             , C.DONG_NAME  dong
             , C.RI_NAME    ri
             , C.LAND_ORGN_NMBR || '-' || C.LAND_ADDT_NMBR landNmbr
             , C.BUILD_NAME|| ' ' || C.BUILD_DETAIL_NAME     bdngNm
             , C.LAND_ORGN_NMBR landOrgnNmbr
             , C.LAND_ADDT_NMBR landAddtNmbr
             , C.ROAD_NAME      roadNm
             , C.BDNG_ORGN_NMBR || (case when C.BDNG_ADDT_NMBR != '0' then '-' || C.BDNG_ADDT_NMBR else '' end) bdngNmbr
             , C.DONG_NAME      roadCode
             , C.SI_GU_ROAD_CODE      bdngManaNmbr
          from TB_ROAD_BUILD C
         where C.MOUNT_YN = '0'
           <isNotEmpty property="si_do">
            AND C.SI_DO_NAME = #si_do#
           </isNotEmpty>
           <isNotEmpty property="si_gu">
            AND C.SI_GU_NAME = #si_gu#
           </isNotEmpty>
           <isNotEmpty property="road_name">
            and C.ROAD_NAME like replace(#road_name#,' ','') || '%'
           </isNotEmpty>
           <isNotEmpty property="bdng_bsc_nmbr">
            and C.BDNG_ORGN_NMBR like #bdng_bsc_nmbr# || '%'
           </isNotEmpty>
           <isNotEmpty property="bdng_addt_nmbr">
            and C.BDNG_ADDT_NMBR like #bdng_addt_nmbr# || '%'
           </isNotEmpty>
           <isNotEmpty property="dong_name">
            and (C.DONG_NAME LIKE  replace(translate(#dong_name#,'0123456789', 'A'),' ','') || '%' OR C.RI_NAME LIKE replace(translate(#dong_name#,'0123456789', 'A'),' ','') || '%') 
           </isNotEmpty>
           <isNotEmpty property="land_bsc_nmbr">
            and C.LAND_ORGN_NMBR like #land_bsc_nmbr# || '%'
           </isNotEmpty>
           <isNotEmpty property="land_addt_nmbr">
            and C.LAND_ADDT_NMBR like #land_addt_nmbr# || '%'
           </isNotEmpty>
           <isNotEmpty property="bdng_name">
            and C.BUILD_NAME like #bdng_name# || '%'
           </isNotEmpty>
         order by C.ROAD_NAME, to_number(C.BDNG_ORGN_NMBR), to_number(C.BDNG_ADDT_NMBR)
    </select>
    
    <select id="countZipcodeList2" resultClass="int" parameterClass="zipcodeCriteria">
        SELECT /*+ RULE */
               NVL(COUNT(*), 0) AS CNT
          from TB_ROAD_BUILD C
         where C.MOUNT_YN = '0'
           <isNotEmpty property="si_do">
            AND C.SI_DO_NAME = #si_do#
           </isNotEmpty>
           <isNotEmpty property="si_gu">
            AND C.SI_GU_NAME = #si_gu#
           </isNotEmpty>
           <isNotEmpty property="road_name">
            and C.ROAD_NAME like replace(#road_name#,' ','') || '%'
           </isNotEmpty>
           <isNotEmpty property="bdng_bsc_nmbr">
            and C.BDNG_ORGN_NMBR like #bdng_bsc_nmbr# || '%'
           </isNotEmpty>
           <isNotEmpty property="bdng_addt_nmbr">
            and C.BDNG_ADDT_NMBR like #bdng_addt_nmbr# || '%'
           </isNotEmpty>
           <isNotEmpty property="dong_name">
            and (C.DONG_NAME LIKE  replace(translate(#dong_name#,'0123456789', 'A'),' ','') || '%' OR C.RI_NAME LIKE replace(translate(#dong_name#,'0123456789', 'A'),' ','') || '%') 
           </isNotEmpty>
           <isNotEmpty property="land_bsc_nmbr">
            and C.LAND_ORGN_NMBR like #land_bsc_nmbr# || '%'
           </isNotEmpty>
           <isNotEmpty property="land_addt_nmbr">
            and C.LAND_ADDT_NMBR like #land_addt_nmbr# || '%'
           </isNotEmpty>
           <isNotEmpty property="bdng_name">
            and C.BUILD_NAME like #bdng_name# || '%'
           </isNotEmpty>
           AND ROWNUM <![CDATA[ < ]]> #topCount# + 1
    </select>
    
    <select id="totalZipcodeList2" resultClass="int" parameterClass="zipcodeCriteria">
        SELECT /*+ RULE */
               NVL(COUNT(*), 0) AS CNT
          from TB_ROAD_BUILD C
         where C.MOUNT_YN = '0'
           <isNotEmpty property="si_do">
            AND C.SI_DO_NAME = #si_do#
           </isNotEmpty>
           <isNotEmpty property="si_gu">
            AND C.SI_GU_NAME = #si_gu#
           </isNotEmpty>
           <isNotEmpty property="road_name">
            and C.ROAD_NAME like replace(#road_name#,' ','') || '%'
           </isNotEmpty>
           <isNotEmpty property="bdng_bsc_nmbr">
            and C.BDNG_ORGN_NMBR like #bdng_bsc_nmbr# || '%'
           </isNotEmpty>
           <isNotEmpty property="bdng_addt_nmbr">
            and C.BDNG_ADDT_NMBR like #bdng_addt_nmbr# || '%'
           </isNotEmpty>
           <isNotEmpty property="dong_name">
            and (C.DONG_NAME LIKE  replace(translate(#dong_name#,'0123456789', 'A'),' ','') || '%' OR C.RI_NAME LIKE replace(translate(#dong_name#,'0123456789', 'A'),' ','') || '%') 
           </isNotEmpty>
           <isNotEmpty property="land_bsc_nmbr">
            and C.LAND_ORGN_NMBR like #land_bsc_nmbr# || '%'
           </isNotEmpty>
           <isNotEmpty property="land_addt_nmbr">
            and C.LAND_ADDT_NMBR like #land_addt_nmbr# || '%'
           </isNotEmpty>
           <isNotEmpty property="bdng_name">
            and C.BUILD_NAME like #bdng_name# || '%'
           </isNotEmpty>
    </select>
    
    <select id="getZipcodeSido" resultClass="zipcode" parameterClass="zipcodeCriteria">
        select distinct SI_GU_NAME gu
          from TB_ROAD_BUILD
         where SI_DO_NAME = #si_do#
         order by SI_GU_NAME
    </select>
</sqlMap>
