<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="BizProductSQL">
    <typeAlias alias="icon" type="kr.co.hottracks.site.model.common.Icon"/>
    <typeAlias alias="sellProductKey" type="kr.co.hottracks.site.model.common.product.SellProductKey"/>
    <typeAlias alias="sellProduct" type="kr.co.hottracks.site.model.common.product.SellProduct"/>
    <typeAlias alias="productImage" type="kr.co.hottracks.site.model.common.product.ProductImage"/>
    <typeAlias alias="optionTemp" type="kr.co.hottracks.site.model.backoffice.product.OptionTemp"/>
    <typeAlias alias="reviewCriteria" type="kr.co.hottracks.site.model.frontoffice.product.ReviewCriteria"/>
    <typeAlias alias="kyoboReview" type="kr.co.hottracks.site.model.common.product.KyoboReview"/>
    <typeAlias alias="mallProduct" type="kr.co.hottracks.site.model.common.product.MallProduct"/>
    <typeAlias alias="prdtNotiInfo" type="kr.co.hottracks.site.model.common.product.PrdtNotiInfo"/>
    
    <!--  
        작성자: 김정호
        작성일: 2019.12.19        
        기능 : 최근 본 상품 조회  
    -->
    <select id="getRecentProductFace" resultClass="kr.co.hottracks.site.model.frontoffice.product.BizRecentProductExt" parameterClass="kr.co.hottracks.site.model.frontoffice.product.BizRecentProductCriteria">
        /* BizProductSQL.getRecentProductFace */
        SELECT A.*
        FROM (
	        SELECT 'ic_01'  																rcntGbn
	             , '상품'						         										rcntGbnName
	        	 , SP.SELL_PRDT_BCODE       												sellPrdtBcode
	             , FC_GET_PRODUCT_IMAGE_URL(SP.SELL_PRDT_BCODE)                             productImageUrl
	             , FC_GET_PRDT_NAME(SP.SELL_PRDT_BCODE, '02')                               prdtName
	             , (SELECT BRAND_NAME FROM TB_BRAND B WHERE B.BRAND_ID = SP.BRAND_ID)       brandName             
	             , SP.PRDT_SELL_PRICE       												prdtSellPrice
	             , FC_GET_CPN_PRICE(SP.SELL_PRDT_BCODE,'02')                                lastCpnPrice
	             , SP.SELL_PRDT_GBN         												sellPrdtGbn
	             , R.RCRD_CD                												rcrdCd
	             , RP.REGST_DTM             
	             , TO_CHAR(RP.REGST_DTM, 'yyyy')											yyyy
	             , TO_CHAR(RP.REGST_DTM, ' MM dd')											mmdd             
	             , CASE WHEN TO_CHAR(RP.REGST_DTM, 'd') = '1' THEN 'sun'
						WHEN TO_CHAR(RP.REGST_DTM, 'd') = '2' THEN 'mon'
			            WHEN TO_CHAR(RP.REGST_DTM, 'd') = '3' THEN 'tue'
			            WHEN TO_CHAR(RP.REGST_DTM, 'd') = '4' THEN 'wed'
			            WHEN TO_CHAR(RP.REGST_DTM, 'd') = '5' THEN 'thur'
			            WHEN TO_CHAR(RP.REGST_DTM, 'd') = '6' THEN 'fri'
			            WHEN TO_CHAR(RP.REGST_DTM, 'd') = '7' THEN 'sat'
			            END 																yoil            		            	             
			     , NVL((SELECT COUNT(1) 
			     		FROM TB_WISH_PRODUCT TP 
			     		WHERE TP.WISH_GBN = 'P' 
			     		AND TP.SELL_PRDT_BCODE = SP.SELL_PRDT_BCODE
			     		AND TP.MALL_ID = '02' 
			     		AND TP.USER_NUM = #userNum#), 0) as 								wishUserPrdtCnt
			     , SP.PRDT_STAT_CODE 														prdtStatCode
			     , SP.RCRD_STAT																rcrdStat	              
	          FROM TB_RECENT_PRODUCT RP
	          JOIN TB_SELL_PRODUCT SP ON RP.SELL_PRDT_BCODE = SP.SELL_PRDT_BCODE
	          LEFT JOIN TB_RECORD R ON SP.SELL_PRDT_BCODE = R.SELL_PRDT_BCODE
	         WHERE RP.MALL_ID = #mallId#
	           	<isNotEmpty property="userNum">
	               AND RP.USER_NUM = #userNum#
	           	</isNotEmpty>
	           	<isNotEmpty property="sesnHashKey">
	               AND RP.USER_NUM IS NULL
	               AND RP.SESN_HASH_KEY = #sesnHashKey#
	           	</isNotEmpty>
	           	<isEmpty property="userNum">
	               <isEmpty property="sesnHashKey">
	                   AND 1 != 1
	               </isEmpty>
	           	</isEmpty>
		        <isNotEmpty property="startDay">	            
	            	AND RP.REGST_DTM <![CDATA[ >= ]]>  TO_DATE(#startDay#||'000000', 'yyyyMMddHH24Miss')
		        </isNotEmpty>
		        <isNotEmpty property="endDay">	            
		            AND RP.REGST_DTM <![CDATA[ <= ]]>  TO_DATE(#endDay#||'235959', 'yyyyMMddHH24Miss')
		        </isNotEmpty>
			UNION ALL
			SELECT 'ic_02'													rcntGbn
				 , '검색'						         						rcntGbnName		
	        	 , TO_CHAR(RK.RCNT_KEY_SEQ)       							sellPrdtBcode
	             , ''               										productImageUrl
	             , RK.KEYWORD       										prdtName
	             , ''														brandName             
	             , 0		    											prdtSellPrice
	             , 0	               										lastCpnPrice
	             , ''		        										sellPrdtGbn
	             , ''               										rcrdCd
	             , RK.REGST_DTM             
	             , TO_CHAR(RK.REGST_DTM, 'yyyy')							yyyy
	             , TO_CHAR(RK.REGST_DTM, ' MM dd')							mmdd             
	             , CASE WHEN TO_CHAR(RK.REGST_DTM, 'd') = '1' THEN 'sun'
						WHEN TO_CHAR(RK.REGST_DTM, 'd') = '2' THEN 'mon'
			            WHEN TO_CHAR(RK.REGST_DTM, 'd') = '3' THEN 'tue'
			            WHEN TO_CHAR(RK.REGST_DTM, 'd') = '4' THEN 'wed'
			            WHEN TO_CHAR(RK.REGST_DTM, 'd') = '5' THEN 'thur'
			            WHEN TO_CHAR(RK.REGST_DTM, 'd') = '6' THEN 'fri'
			            WHEN TO_CHAR(RK.REGST_DTM, 'd') = '7' THEN 'sat'
			            END 												yoil            		            	             
			     , 0 as 													wishUserPrdtCnt
			     , '' 														prdtStatCode
			     , ''														rcrdStat			     		
			FROM TB_RECENT_KEYWORD RK
			WHERE 1=1		
	           	<isNotEmpty property="userNum">
	               AND RK.USER_NUM = #userNum#
	           	</isNotEmpty>
	           	<isNotEmpty property="sesnHashKey">
	               AND RK.USER_NUM IS NULL
	               AND RK.SESN_HASH_KEY = #sesnHashKey#
	           	</isNotEmpty>
	           	<isEmpty property="userNum">
	               <isEmpty property="sesnHashKey">
	                   AND 1 != 1
	               </isEmpty>
	           	</isEmpty>
		        <isNotEmpty property="startDay">	            
	            	AND RK.REGST_DTM <![CDATA[ >= ]]>  TO_DATE(#startDay#||'000000', 'yyyyMMddHH24Miss')
		        </isNotEmpty>
		        <isNotEmpty property="endDay">	            
		            AND RK.REGST_DTM <![CDATA[ <= ]]>  TO_DATE(#endDay#||'235959', 'yyyyMMddHH24Miss')
		        </isNotEmpty>		       
			UNION ALL
			SELECT CASE WHEN NEW_EVENT_DISP_TYPE_CODE = 'C1531' THEN 'ic_03'
															ELSE 'ic_04'
															END AS 			rcntGbn
				 , CASE WHEN NEW_EVENT_DISP_TYPE_CODE = 'C1531' THEN '기획전'
															ELSE '이벤트'
															END AS 			rcntGbnName															
	        	 , RE.EVENT_ID       										sellPrdtBcode
	             , ''               										productImageUrl
	             , EM.EVENT_TITLE       									prdtName
	             , ''														brandName             
	             , 0		    											prdtSellPrice
	             , 0	               										lastCpnPrice
	             , ''		        										sellPrdtGbn
	             , ''               										rcrdCd
	             , RE.REGST_DTM             
	             , TO_CHAR(RE.REGST_DTM, 'yyyy')							yyyy
	             , TO_CHAR(RE.REGST_DTM, ' MM dd')							mmdd             
	             , CASE WHEN TO_CHAR(RE.REGST_DTM, 'd') = '1' THEN 'sun'
						WHEN TO_CHAR(RE.REGST_DTM, 'd') = '2' THEN 'mon'
			            WHEN TO_CHAR(RE.REGST_DTM, 'd') = '3' THEN 'tue'
			            WHEN TO_CHAR(RE.REGST_DTM, 'd') = '4' THEN 'wed'
			            WHEN TO_CHAR(RE.REGST_DTM, 'd') = '5' THEN 'thur'
			            WHEN TO_CHAR(RE.REGST_DTM, 'd') = '6' THEN 'fri'
			            WHEN TO_CHAR(RE.REGST_DTM, 'd') = '7' THEN 'sat'
			            END 												yoil            		            	             
			     , 0 as 													wishUserPrdtCnt			
			     , CASE WHEN TO_DATE(EM.EVENT_END_DT||'235959', 'yyyyMMddHH24Miss') <![CDATA[ <= ]]>  TO_DATE(TO_CHAR(SYSDATE,'yyyyMMdd')||'235959', 'yyyyMMddHH24Miss')
			     		THEN 'N'
			     		ELSE 'Y'
   						END 												prdtStatCode
			     , ''														rcrdStat			     
			FROM TB_RECENT_EVENT RE
			INNER JOIN TB_EVENT_MASTER EM ON RE.EVENT_ID = EM.EVENT_ID
			WHERE 1=1		
	           	<isNotEmpty property="userNum">
	               AND RE.USER_NUM = #userNum#
	           	</isNotEmpty>
	           	<isNotEmpty property="sesnHashKey">
	               AND RE.USER_NUM IS NULL
	               AND RE.SESN_HASH_KEY = #sesnHashKey#
	           	</isNotEmpty>
	           	<isEmpty property="userNum">
	               <isEmpty property="sesnHashKey">
	                   AND 1 != 1
	               </isEmpty>
	           	</isEmpty>
		        <isNotEmpty property="startDay">	            
	            	AND RE.REGST_DTM <![CDATA[ >= ]]>  TO_DATE(#startDay#||'000000', 'yyyyMMddHH24Miss')
		        </isNotEmpty>
		        <isNotEmpty property="endDay">	            
		            AND RE.REGST_DTM <![CDATA[ <= ]]>  TO_DATE(#endDay#||'235959', 'yyyyMMddHH24Miss')
		        </isNotEmpty>		        
			UNION ALL
			SELECT 'ic_05'													rcntGbn
				 , '브랜드'						         					rcntGbnName
	        	 , RB.BRAND_ID		       									sellPrdtBcode
	             , ''               										productImageUrl
	             , BR.BRAND_NAME	       									prdtName
	             , ''														brandName             
	             , 0		    											prdtSellPrice
	             , 0	               										lastCpnPrice
	             , ''		        										sellPrdtGbn
	             , ''               										rcrdCd
	             , RB.REGST_DTM             
	             , TO_CHAR(RB.REGST_DTM, 'yyyy')							yyyy
	             , TO_CHAR(RB.REGST_DTM, ' MM dd')							mmdd             
	             , CASE WHEN TO_CHAR(RB.REGST_DTM, 'd') = '1' THEN 'sun'
						WHEN TO_CHAR(RB.REGST_DTM, 'd') = '2' THEN 'mon'
			            WHEN TO_CHAR(RB.REGST_DTM, 'd') = '3' THEN 'tue'
			            WHEN TO_CHAR(RB.REGST_DTM, 'd') = '4' THEN 'wed'
			            WHEN TO_CHAR(RB.REGST_DTM, 'd') = '5' THEN 'thur'
			            WHEN TO_CHAR(RB.REGST_DTM, 'd') = '6' THEN 'fri'
			            WHEN TO_CHAR(RB.REGST_DTM, 'd') = '7' THEN 'sat'
			            END 												yoil            		            	             			     
			     , NVL((SELECT COUNT(1) 
			     		FROM TB_WISH_PRODUCT T 
			     		WHERE T.WISH_GBN = 'B' 
			     		AND T.BRAND_ID = BR.BRAND_ID 
			     		AND T.MALL_ID = '02' 
			     		AND T.USER_NUM = #userNum#), 0)   					wishUserPrdtCnt
			     , '' 														prdtStatCode
			     , ''														rcrdStat			     		
			FROM TB_RECENT_BRAND RB
			INNER JOIN TB_BRAND BR ON RB.BRAND_ID = BR.BRAND_ID
			WHERE 1=1		
	           	<isNotEmpty property="userNum">
	               AND RB.USER_NUM = #userNum#
	           	</isNotEmpty>
	           	<isNotEmpty property="sesnHashKey">
	               AND RB.USER_NUM IS NULL
	               AND RB.SESN_HASH_KEY = #sesnHashKey#
	           	</isNotEmpty>
	           	<isEmpty property="userNum">
	               <isEmpty property="sesnHashKey">
	                   AND 1 != 1
	               </isEmpty>
	           	</isEmpty>
		        <isNotEmpty property="startDay">	            
	            	AND RB.REGST_DTM <![CDATA[ >= ]]>  TO_DATE(#startDay#||'000000', 'yyyyMMddHH24Miss')
		        </isNotEmpty>
		        <isNotEmpty property="endDay">	            
		            AND RB.REGST_DTM <![CDATA[ <= ]]>  TO_DATE(#endDay#||'235959', 'yyyyMMddHH24Miss')
		        </isNotEmpty>		        		        	        						
        ) A                   
        ORDER BY A.REGST_DTM DESC    
    </select>

    <!--  
        작성자: 김정호
        작성일: 2019.12.19        
        기능 : 최근 본 상품 조회  
    -->
    <select id="totalRecentProductFace" resultClass="int" parameterClass="kr.co.hottracks.site.model.frontoffice.product.BizRecentProductCriteria">
        /* BizProductSQL.totalRecentProductFace */
        SELECT COUNT(rcntGbn)
        FROM (
	        SELECT 'ic_01'  																rcntGbn 	             
	          FROM TB_RECENT_PRODUCT RP
	          JOIN TB_SELL_PRODUCT SP ON RP.SELL_PRDT_BCODE = SP.SELL_PRDT_BCODE
	          LEFT JOIN TB_RECORD R ON SP.SELL_PRDT_BCODE = R.SELL_PRDT_BCODE
	         WHERE RP.MALL_ID = #mallId#
	           	<isNotEmpty property="userNum">
	               AND RP.USER_NUM = #userNum#
	           	</isNotEmpty>
	           	<isNotEmpty property="sesnHashKey">
	               AND RP.USER_NUM IS NULL
	               AND RP.SESN_HASH_KEY = #sesnHashKey#
	           	</isNotEmpty>
	           	<isEmpty property="userNum">
	               <isEmpty property="sesnHashKey">
	                   AND 1 != 1
	               </isEmpty>
	           	</isEmpty>
		        <isNotEmpty property="startDay">	            
	            	AND RP.REGST_DTM <![CDATA[ >= ]]>  TO_DATE(#startDay#||'000000', 'yyyyMMddHH24Miss')
		        </isNotEmpty>
		        <isNotEmpty property="endDay">	            
		            AND RP.REGST_DTM <![CDATA[ <= ]]>  TO_DATE(#endDay#||'235959', 'yyyyMMddHH24Miss')
		        </isNotEmpty>
			UNION ALL
			SELECT 'ic_02'													rcntGbn							     		
			FROM TB_RECENT_KEYWORD RK
			WHERE 1=1		
	           	<isNotEmpty property="userNum">
	               AND RK.USER_NUM = #userNum#
	           	</isNotEmpty>
	           	<isNotEmpty property="sesnHashKey">
	               AND RK.USER_NUM IS NULL
	               AND RK.SESN_HASH_KEY = #sesnHashKey#
	           	</isNotEmpty>
	           	<isEmpty property="userNum">
	               <isEmpty property="sesnHashKey">
	                   AND 1 != 1
	               </isEmpty>
	           	</isEmpty>
		        <isNotEmpty property="startDay">	            
	            	AND RK.REGST_DTM <![CDATA[ >= ]]>  TO_DATE(#startDay#||'000000', 'yyyyMMddHH24Miss')
		        </isNotEmpty>
		        <isNotEmpty property="endDay">	            
		            AND RK.REGST_DTM <![CDATA[ <= ]]>  TO_DATE(#endDay#||'235959', 'yyyyMMddHH24Miss')
		        </isNotEmpty>		       
			UNION ALL
			SELECT CASE WHEN NEW_EVENT_DISP_TYPE_CODE = 'C1531' THEN 'ic_03'
															ELSE 'ic_04'
															END AS 			rcntGbn																					     
			FROM TB_RECENT_EVENT RE
			INNER JOIN TB_EVENT_MASTER EM ON RE.EVENT_ID = EM.EVENT_ID
			WHERE 1=1		
	           	<isNotEmpty property="userNum">
	               AND RE.USER_NUM = #userNum#
	           	</isNotEmpty>
	           	<isNotEmpty property="sesnHashKey">
	               AND RE.USER_NUM IS NULL
	               AND RE.SESN_HASH_KEY = #sesnHashKey#
	           	</isNotEmpty>
	           	<isEmpty property="userNum">
	               <isEmpty property="sesnHashKey">
	                   AND 1 != 1
	               </isEmpty>
	           	</isEmpty>
		        <isNotEmpty property="startDay">	            
	            	AND RE.REGST_DTM <![CDATA[ >= ]]>  TO_DATE(#startDay#||'000000', 'yyyyMMddHH24Miss')
		        </isNotEmpty>
		        <isNotEmpty property="endDay">	            
		            AND RE.REGST_DTM <![CDATA[ <= ]]>  TO_DATE(#endDay#||'235959', 'yyyyMMddHH24Miss')
		        </isNotEmpty>		        
			UNION ALL
			SELECT 'ic_05'													rcntGbn																				        				     		
			FROM TB_RECENT_BRAND RB
			INNER JOIN TB_BRAND BR ON RB.BRAND_ID = BR.BRAND_ID
			WHERE 1=1		
	           	<isNotEmpty property="userNum">
	               AND RB.USER_NUM = #userNum#
	           	</isNotEmpty>
	           	<isNotEmpty property="sesnHashKey">
	               AND RB.USER_NUM IS NULL
	               AND RB.SESN_HASH_KEY = #sesnHashKey#
	           	</isNotEmpty>
	           	<isEmpty property="userNum">
	               <isEmpty property="sesnHashKey">
	                   AND 1 != 1
	               </isEmpty>
	           	</isEmpty>
		        <isNotEmpty property="startDay">	            
	            	AND RB.REGST_DTM <![CDATA[ >= ]]>  TO_DATE(#startDay#||'000000', 'yyyyMMddHH24Miss')
		        </isNotEmpty>
		        <isNotEmpty property="endDay">	            
		            AND RB.REGST_DTM <![CDATA[ <= ]]>  TO_DATE(#endDay#||'235959', 'yyyyMMddHH24Miss')
		        </isNotEmpty>		        		        	        						
        ) A                            
    </select>
    
    <!-- 
        작성자: 김정호
        작성일: 2019.12.23
        기능: 최근 본 상품 삭제
     -->
    <delete id="deleteBizRecentProduct" parameterClass="kr.co.hottracks.site.model.frontoffice.product.BizRecentProduct">
        /* BizProductSQL.deleteBizRecentProduct */
        DELETE
          FROM TB_RECENT_PRODUCT
         WHERE MALL_ID = #mallId#
           AND INSTR(#ic01Data#, SELL_PRDT_BCODE) > 0
           <isNotEmpty property="userNum">
               AND USER_NUM = #userNum#
           </isNotEmpty>
           <isNotEmpty property="sesnHashKey">
               AND USER_NUM IS NULL
               AND SESN_HASH_KEY = #sesnHashKey#
           </isNotEmpty>
           <isEmpty property="userNum">
               <isEmpty property="sesnHashKey">
                   AND 1 != 1
               </isEmpty>
           </isEmpty>
    </delete>
    
    <!-- 
        작성자: 김정호
        작성일: 2019.12.23
        기능: 최근 본 검색어 삭제
     -->
    <delete id="deleteBizRecentSearch" parameterClass="kr.co.hottracks.site.model.frontoffice.product.BizRecentProduct">
        /* BizProductSQL.deleteBizRecentSearch */
        DELETE
          FROM TB_RECENT_KEYWORD
         WHERE 1=1
           AND INSTR(#ic02Data#, RCNT_KEY_SEQ) > 0
           <isNotEmpty property="userNum">
               AND USER_NUM = #userNum#
           </isNotEmpty>
           <isNotEmpty property="sesnHashKey">
               AND USER_NUM IS NULL
               AND SESN_HASH_KEY = #sesnHashKey#
           </isNotEmpty>
           <isEmpty property="userNum">
               <isEmpty property="sesnHashKey">
                   AND 1 != 1
               </isEmpty>
           </isEmpty>
    </delete>
    
    <!-- 
        작성자: 김정호
        작성일: 2019.12.23
        기능: 최근 본 기획전 삭제
     -->
    <delete id="deleteBizRecentExhibition" parameterClass="kr.co.hottracks.site.model.frontoffice.product.BizRecentProduct">
        /* BizProductSQL.deleteBizRecentExhibition */
        DELETE
          FROM TB_RECENT_EVENT
         WHERE 1=1
           AND INSTR(#ic03Data#, EVENT_ID) > 0
           <isNotEmpty property="userNum">
               AND USER_NUM = #userNum#
           </isNotEmpty>
           <isNotEmpty property="sesnHashKey">
               AND USER_NUM IS NULL
               AND SESN_HASH_KEY = #sesnHashKey#
           </isNotEmpty>
           <isEmpty property="userNum">
               <isEmpty property="sesnHashKey">
                   AND 1 != 1
               </isEmpty>
           </isEmpty>
    </delete>     
    
    <!-- 
        작성자: 김정호
        작성일: 2019.12.23
        기능: 최근 본 이벤트 삭제
     -->
    <delete id="deleteBizRecentEvent" parameterClass="kr.co.hottracks.site.model.frontoffice.product.BizRecentProduct">
        /* BizProductSQL.deleteBizRecentEvent */
        DELETE
          FROM TB_RECENT_EVENT
         WHERE 1=1
           AND INSTR(#ic04Data#, EVENT_ID) > 0
           <isNotEmpty property="userNum">
               AND USER_NUM = #userNum#
           </isNotEmpty>
           <isNotEmpty property="sesnHashKey">
               AND USER_NUM IS NULL
               AND SESN_HASH_KEY = #sesnHashKey#
           </isNotEmpty>
           <isEmpty property="userNum">
               <isEmpty property="sesnHashKey">
                   AND 1 != 1
               </isEmpty>
           </isEmpty>
    </delete>
    
    <!-- 
        작성자: 김정호
        작성일: 2019.12.23
        기능: 최근 본 브랜드 삭제
     -->
    <delete id="deleteBizRecentBrand" parameterClass="kr.co.hottracks.site.model.frontoffice.product.BizRecentProduct">    
        /* BizProductSQL.deleteBizRecentEvent */
        DELETE
          FROM TB_RECENT_BRAND
         WHERE 1=1
           AND INSTR(#ic05Data#, BRAND_ID) > 0
           <isNotEmpty property="userNum">
               AND USER_NUM = #userNum#
           </isNotEmpty>
           <isNotEmpty property="sesnHashKey">
               AND USER_NUM IS NULL
               AND SESN_HASH_KEY = #sesnHashKey#
           </isNotEmpty>
           <isEmpty property="userNum">
               <isEmpty property="sesnHashKey">
                   AND 1 != 1
               </isEmpty>
           </isEmpty>
    </delete>
    
    <!--  
        작성자: 김정호
        작성일: 2019.12.19        
        기능 : 최근 본 상품목록 존재여부 반환  
    -->
    <select id="getRecentProductYN" resultClass="kr.co.hottracks.site.model.frontoffice.product.BizRecentProductExt" parameterClass="kr.co.hottracks.site.model.frontoffice.product.BizRecentProductCriteria">
        /* BizProductSQL.getRecentProductYN */
        SELECT 'ic_01' rcntGbn
        	, CASE WHEN COUNT(*) = 0 THEN 'N' ELSE 'Y' END AS rcntGbnYn            
          FROM TB_RECENT_PRODUCT RP
          JOIN TB_SELL_PRODUCT SP ON RP.SELL_PRDT_BCODE = SP.SELL_PRDT_BCODE
          LEFT JOIN TB_RECORD R ON SP.SELL_PRDT_BCODE = R.SELL_PRDT_BCODE
         WHERE RP.MALL_ID = #mallId#
           	<isNotEmpty property="userNum">
               AND RP.USER_NUM = #userNum#
           	</isNotEmpty>
           	<isNotEmpty property="sesnHashKey">
               AND RP.USER_NUM IS NULL
               AND RP.SESN_HASH_KEY = #sesnHashKey#
           	</isNotEmpty>
           	<isEmpty property="userNum">
               <isEmpty property="sesnHashKey">
                   AND 1 != 1
               </isEmpty>
           	</isEmpty>
	        <isNotEmpty property="startDay">	            
            	AND RP.REGST_DTM <![CDATA[ >= ]]>  TO_DATE(#startDay#||'000000', 'yyyyMMddHH24Miss')
	        </isNotEmpty>
	        <isNotEmpty property="endDay">	            
	            AND RP.REGST_DTM <![CDATA[ <= ]]>  TO_DATE(#endDay#||'235959', 'yyyyMMddHH24Miss')
	        </isNotEmpty>
		UNION ALL
		SELECT 'ic_02'	rcntGbn			
        	 , CASE WHEN COUNT(*) = 0 THEN 'N' ELSE 'Y' END AS rcntGbnYn 	            		
		FROM TB_RECENT_KEYWORD RK
		WHERE 1=1		
           	<isNotEmpty property="userNum">
               AND RK.USER_NUM = #userNum#
           	</isNotEmpty>
           	<isNotEmpty property="sesnHashKey">
               AND RK.USER_NUM IS NULL
               AND RK.SESN_HASH_KEY = #sesnHashKey#
           	</isNotEmpty>
           	<isEmpty property="userNum">
               <isEmpty property="sesnHashKey">
                   AND 1 != 1
               </isEmpty>
           	</isEmpty>		        
			<isNotEmpty property="startDay">	            
            	AND RK.REGST_DTM <![CDATA[ >= ]]>  TO_DATE(#startDay#||'000000', 'yyyyMMddHH24Miss')
	        </isNotEmpty>
	        <isNotEmpty property="endDay">	            
	            AND RK.REGST_DTM <![CDATA[ <= ]]>  TO_DATE(#endDay#||'235959', 'yyyyMMddHH24Miss')
	        </isNotEmpty>		        
		UNION ALL
		SELECT 'ic_03'	rcntGbn
			, CASE WHEN COUNT(*) = 0 THEN 'N' ELSE 'Y' END AS rcntGbnYn						
		FROM TB_RECENT_EVENT RE
		INNER JOIN TB_EVENT_MASTER EM ON RE.EVENT_ID = EM.EVENT_ID
		WHERE NEW_EVENT_DISP_TYPE_CODE = 'C1531'		
           	<isNotEmpty property="userNum">
               AND RE.USER_NUM = #userNum#
           	</isNotEmpty>
           	<isNotEmpty property="sesnHashKey">
               AND RE.USER_NUM IS NULL
               AND RE.SESN_HASH_KEY = #sesnHashKey#
           	</isNotEmpty>
           	<isEmpty property="userNum">
               <isEmpty property="sesnHashKey">
                   AND 1 != 1
               </isEmpty>
           	</isEmpty>		        
			<isNotEmpty property="startDay">	            
            	AND RE.REGST_DTM <![CDATA[ >= ]]>  TO_DATE(#startDay#||'000000', 'yyyyMMddHH24Miss')
	        </isNotEmpty>
	        <isNotEmpty property="endDay">	            
	            AND RE.REGST_DTM <![CDATA[ <= ]]>  TO_DATE(#endDay#||'235959', 'yyyyMMddHH24Miss')
	        </isNotEmpty>
		UNION ALL
		SELECT 'ic_04'	rcntGbn
			, CASE WHEN COUNT(*) = 0 THEN 'N' ELSE 'Y' END AS rcntGbnYn						
		FROM TB_RECENT_EVENT RE
		INNER JOIN TB_EVENT_MASTER EM ON RE.EVENT_ID = EM.EVENT_ID
		WHERE NVL(EM.EVENT_DISP_TYPE_CODE, 'NULL') != 'C0214'		
           	<isNotEmpty property="userNum">
               AND RE.USER_NUM = #userNum#
           	</isNotEmpty>
           	<isNotEmpty property="sesnHashKey">
               AND RE.USER_NUM IS NULL
               AND RE.SESN_HASH_KEY = #sesnHashKey#
           	</isNotEmpty>
           	<isEmpty property="userNum">
               <isEmpty property="sesnHashKey">
                   AND 1 != 1
               </isEmpty>
           	</isEmpty>		        
			<isNotEmpty property="startDay">	            
            	AND RE.REGST_DTM <![CDATA[ >= ]]>  TO_DATE(#startDay#||'000000', 'yyyyMMddHH24Miss')
	        </isNotEmpty>
	        <isNotEmpty property="endDay">	            
	            AND RE.REGST_DTM <![CDATA[ <= ]]>  TO_DATE(#endDay#||'235959', 'yyyyMMddHH24Miss')
	        </isNotEmpty>		        		        		       
		UNION ALL
		SELECT 'ic_05'	rcntGbn																			
        	 , CASE WHEN COUNT(*) = 0 THEN 'N' ELSE 'Y' END AS rcntGbnYn	             
		FROM TB_RECENT_BRAND RB
		INNER JOIN TB_BRAND BR ON RB.BRAND_ID = BR.BRAND_ID
		WHERE 1=1		
           	<isNotEmpty property="userNum">
               AND RB.USER_NUM = #userNum#
           	</isNotEmpty>
           	<isNotEmpty property="sesnHashKey">
               AND RB.USER_NUM IS NULL
               AND RB.SESN_HASH_KEY = #sesnHashKey#
           	</isNotEmpty>
           	<isEmpty property="userNum">
               <isEmpty property="sesnHashKey">
                   AND 1 != 1
               </isEmpty>
           	</isEmpty>		        
			<isNotEmpty property="startDay">	            
            	AND RB.REGST_DTM <![CDATA[ >= ]]>  TO_DATE(#startDay#||'000000', 'yyyyMMddHH24Miss')
	        </isNotEmpty>
	        <isNotEmpty property="endDay">	            
	            AND RB.REGST_DTM <![CDATA[ <= ]]>  TO_DATE(#endDay#||'235959', 'yyyyMMddHH24Miss')
	        </isNotEmpty>
    </select>

    <!--  
        작성자: 김정호
        작성일: 2019.12.18        
        기능 : 최근 본 상품목록 반환  
    -->
    <select id="getRecentProduct" resultClass="kr.co.hottracks.site.model.frontoffice.product.BizRecentProductExt" parameterClass="kr.co.hottracks.site.model.frontoffice.product.BizRecentProductCriteria">
        /* BizProductSQL.getRecentProduct */
        SELECT A.*
        FROM (
	        SELECT 'ic_01'  																rcntGbn 
	        	 , SP.SELL_PRDT_BCODE       												sellPrdtBcode
	             , FC_GET_PRODUCT_IMAGE_URL(SP.SELL_PRDT_BCODE)                             productImageUrl
	             , FC_GET_PRDT_NAME(SP.SELL_PRDT_BCODE, '02')                               prdtName
	             , (SELECT BRAND_NAME FROM TB_BRAND B WHERE B.BRAND_ID = SP.BRAND_ID)       brandName             
	             , SP.PRDT_SELL_PRICE       												prdtSellPrice
	             , FC_GET_CPN_PRICE(SP.SELL_PRDT_BCODE,'02')                                lastCpnPrice
	             , SP.SELL_PRDT_GBN         												sellPrdtGbn
	             , R.RCRD_CD                												rcrdCd
	             , RP.REGST_DTM
	             , TO_CHAR(RP.REGST_DTM, 'yyyy')											yyyy
	             , TO_CHAR(RP.REGST_DTM, ' MM dd')											mmdd             
	             , CASE WHEN TO_CHAR(RP.REGST_DTM, 'd') = '1' THEN 'sun'
						WHEN TO_CHAR(RP.REGST_DTM, 'd') = '2' THEN 'mon'
			            WHEN TO_CHAR(RP.REGST_DTM, 'd') = '3' THEN 'tue'
			            WHEN TO_CHAR(RP.REGST_DTM, 'd') = '4' THEN 'wed'
			            WHEN TO_CHAR(RP.REGST_DTM, 'd') = '5' THEN 'thur'
			            WHEN TO_CHAR(RP.REGST_DTM, 'd') = '6' THEN 'fri'
			            WHEN TO_CHAR(RP.REGST_DTM, 'd') = '7' THEN 'sat'
			            END 																yoil            		            	             
			     , NVL((SELECT COUNT(1) 
			     		FROM TB_WISH_PRODUCT TP 
			     		WHERE TP.WISH_GBN = 'P' 
			     		AND TP.SELL_PRDT_BCODE = SP.SELL_PRDT_BCODE
			     		AND TP.MALL_ID = '02' 
			     		AND TP.USER_NUM = #userNum#), 0) as 								wishUserPrdtCnt
			     , SP.PRDT_STAT_CODE 														prdtStatCode
			     , SP.RCRD_STAT																rcrdStat	              
	          FROM TB_RECENT_PRODUCT RP
	          JOIN TB_SELL_PRODUCT SP ON RP.SELL_PRDT_BCODE = SP.SELL_PRDT_BCODE
	          LEFT JOIN TB_RECORD R ON SP.SELL_PRDT_BCODE = R.SELL_PRDT_BCODE
	         WHERE RP.MALL_ID = #mallId#
	           	<isNotEmpty property="userNum">
	               AND RP.USER_NUM = #userNum#
	           	</isNotEmpty>
	           	<isNotEmpty property="sesnHashKey">
	               AND RP.USER_NUM IS NULL
	               AND RP.SESN_HASH_KEY = #sesnHashKey#
	           	</isNotEmpty>
	           	<isEmpty property="userNum">
	               <isEmpty property="sesnHashKey">
	                   AND 1 != 1
	               </isEmpty>
	           	</isEmpty>
		        <!-- <isNotEmpty property="rcntAccDtm">
		            AND TO_CHAR(RP.REGST_DTM, 'yyyyMMdd') = #rcntAccDtm#
		        </isNotEmpty> -->
		        <isNotEmpty property="startDay">	            
	            	AND RP.REGST_DTM <![CDATA[ >= ]]>  TO_DATE(#startDay#||'000000', 'yyyyMMddHH24Miss')
		        </isNotEmpty>
		        <isNotEmpty property="endDay">	            
		            AND RP.REGST_DTM <![CDATA[ <= ]]>  TO_DATE(#endDay#||'235959', 'yyyyMMddHH24Miss')
		        </isNotEmpty>
			UNION ALL
			SELECT 'ic_02'													rcntGbn			
	        	 , TO_CHAR(RK.RCNT_KEY_SEQ)       							sellPrdtBcode
	             , ''               										productImageUrl
	             , RK.KEYWORD       										prdtName
	             , ''														brandName             
	             , 0		    											prdtSellPrice
	             , 0	               										lastCpnPrice
	             , ''		        										sellPrdtGbn
	             , ''               										rcrdCd
	             , RK.REGST_DTM             
	             , TO_CHAR(RK.REGST_DTM, 'yyyy')							yyyy
	             , TO_CHAR(RK.REGST_DTM, ' MM dd')							mmdd             
	             , CASE WHEN TO_CHAR(RK.REGST_DTM, 'd') = '1' THEN 'sun'
						WHEN TO_CHAR(RK.REGST_DTM, 'd') = '2' THEN 'mon'
			            WHEN TO_CHAR(RK.REGST_DTM, 'd') = '3' THEN 'tue'
			            WHEN TO_CHAR(RK.REGST_DTM, 'd') = '4' THEN 'wed'
			            WHEN TO_CHAR(RK.REGST_DTM, 'd') = '5' THEN 'thur'
			            WHEN TO_CHAR(RK.REGST_DTM, 'd') = '6' THEN 'fri'
			            WHEN TO_CHAR(RK.REGST_DTM, 'd') = '7' THEN 'sat'
			            END 												yoil            		            	             
			     , 0 as 													wishUserPrdtCnt
			     , '' 														prdtStatCode
			     , ''														rcrdStat			     		
			FROM TB_RECENT_KEYWORD RK
			WHERE 1=1		
	           	<isNotEmpty property="userNum">
	               AND RK.USER_NUM = #userNum#
	           	</isNotEmpty>
	           	<isNotEmpty property="sesnHashKey">
	               AND RK.USER_NUM IS NULL
	               AND RK.SESN_HASH_KEY = #sesnHashKey#
	           	</isNotEmpty>
	           	<isEmpty property="userNum">
	               <isEmpty property="sesnHashKey">
	                   AND 1 != 1
	               </isEmpty>
	           	</isEmpty>
		        <!-- <isNotEmpty property="rcntAccDtm">
		            AND TO_CHAR(RK.REGST_DTM, 'yyyyMMdd') = #rcntAccDtm#
		        </isNotEmpty> -->
		        <isNotEmpty property="startDay">	            
	            	AND RK.REGST_DTM <![CDATA[ >= ]]>  TO_DATE(#startDay#||'000000', 'yyyyMMddHH24Miss')
		        </isNotEmpty>
		        <isNotEmpty property="endDay">	            
		            AND RK.REGST_DTM <![CDATA[ <= ]]>  TO_DATE(#endDay#||'235959', 'yyyyMMddHH24Miss')
		        </isNotEmpty>
			UNION ALL
			SELECT CASE WHEN NEW_EVENT_DISP_TYPE_CODE = 'C1531' THEN 'ic_03'
															ELSE 'ic_04'
															END AS 			rcntGbn																		
	        	 , RE.EVENT_ID       										sellPrdtBcode
	             , ''               										productImageUrl
	             , EM.EVENT_TITLE       									prdtName
	             , ''														brandName             
	             , 0		    											prdtSellPrice
	             , 0	               										lastCpnPrice
	             , ''		        										sellPrdtGbn
	             , ''               										rcrdCd
	             , RE.REGST_DTM             
	             , TO_CHAR(RE.REGST_DTM, 'yyyy')							yyyy
	             , TO_CHAR(RE.REGST_DTM, ' MM dd')							mmdd             
	             , CASE WHEN TO_CHAR(RE.REGST_DTM, 'd') = '1' THEN 'sun'
						WHEN TO_CHAR(RE.REGST_DTM, 'd') = '2' THEN 'mon'
			            WHEN TO_CHAR(RE.REGST_DTM, 'd') = '3' THEN 'tue'
			            WHEN TO_CHAR(RE.REGST_DTM, 'd') = '4' THEN 'wed'
			            WHEN TO_CHAR(RE.REGST_DTM, 'd') = '5' THEN 'thur'
			            WHEN TO_CHAR(RE.REGST_DTM, 'd') = '6' THEN 'fri'
			            WHEN TO_CHAR(RE.REGST_DTM, 'd') = '7' THEN 'sat'
			            END 												yoil            		            	             
			     , 0 as 													wishUserPrdtCnt			
			     , CASE WHEN TO_DATE(EM.EVENT_END_DT||'235959', 'yyyyMMddHH24Miss') <![CDATA[ <= ]]>  TO_DATE('20191218'||'235959', 'yyyyMMddHH24Miss')
			     		THEN 'N'
			     		ELSE 'Y'
   						END 												prdtStatCode
			     , ''														rcrdStat			     
			FROM TB_RECENT_EVENT RE
			INNER JOIN TB_EVENT_MASTER EM ON RE.EVENT_ID = EM.EVENT_ID
			WHERE 1=1		
	           	<isNotEmpty property="userNum">
	               AND RE.USER_NUM = #userNum#
	           	</isNotEmpty>
	           	<isNotEmpty property="sesnHashKey">
	               AND RE.USER_NUM IS NULL
	               AND RE.SESN_HASH_KEY = #sesnHashKey#
	           	</isNotEmpty>
	           	<isEmpty property="userNum">
	               <isEmpty property="sesnHashKey">
	                   AND 1 != 1
	               </isEmpty>
	           	</isEmpty>
		        <!-- <isNotEmpty property="rcntAccDtm">
		            AND TO_CHAR(RE.REGST_DTM, 'yyyyMMdd') = #rcntAccDtm#
		        </isNotEmpty> -->
		        <isNotEmpty property="startDay">	            
	            	AND RE.REGST_DTM <![CDATA[ >= ]]>  TO_DATE(#startDay#||'000000', 'yyyyMMddHH24Miss')
		        </isNotEmpty>
		        <isNotEmpty property="endDay">	            
		            AND RE.REGST_DTM <![CDATA[ <= ]]>  TO_DATE(#endDay#||'235959', 'yyyyMMddHH24Miss')
		        </isNotEmpty>
			UNION ALL
			SELECT 'ic_05'													rcntGbn																			
	        	 , RB.BRAND_ID		       									sellPrdtBcode
	             , ''               										productImageUrl
	             , BR.BRAND_NAME	       									prdtName
	             , ''														brandName             
	             , 0		    											prdtSellPrice
	             , 0	               										lastCpnPrice
	             , ''		        										sellPrdtGbn
	             , ''               										rcrdCd
	             , RB.REGST_DTM             
	             , TO_CHAR(RB.REGST_DTM, 'yyyy')							yyyy
	             , TO_CHAR(RB.REGST_DTM, ' MM dd')							mmdd             
	             , CASE WHEN TO_CHAR(RB.REGST_DTM, 'd') = '1' THEN 'sun'
						WHEN TO_CHAR(RB.REGST_DTM, 'd') = '2' THEN 'mon'
			            WHEN TO_CHAR(RB.REGST_DTM, 'd') = '3' THEN 'tue'
			            WHEN TO_CHAR(RB.REGST_DTM, 'd') = '4' THEN 'wed'
			            WHEN TO_CHAR(RB.REGST_DTM, 'd') = '5' THEN 'thur'
			            WHEN TO_CHAR(RB.REGST_DTM, 'd') = '6' THEN 'fri'
			            WHEN TO_CHAR(RB.REGST_DTM, 'd') = '7' THEN 'sat'
			            END 												yoil            		            	             			     
			     , NVL((SELECT COUNT(1) 
			     		FROM TB_WISH_PRODUCT T 
			     		WHERE T.WISH_GBN = 'B' 
			     		AND T.BRAND_ID = BR.BRAND_ID 
			     		AND T.MALL_ID = '02' 
			     		AND T.USER_NUM = #userNum#), 0)   					wishUserPrdtCnt
			     , '' 														prdtStatCode
			     , ''														rcrdStat			     		
			FROM TB_RECENT_BRAND RB
			INNER JOIN TB_BRAND BR ON RB.BRAND_ID = BR.BRAND_ID
			WHERE 1=1		
	           	<isNotEmpty property="userNum">
	               AND RB.USER_NUM = #userNum#
	           	</isNotEmpty>
	           	<isNotEmpty property="sesnHashKey">
	               AND RB.USER_NUM IS NULL
	               AND RB.SESN_HASH_KEY = #sesnHashKey#
	           	</isNotEmpty>
	           	<isEmpty property="userNum">
	               <isEmpty property="sesnHashKey">
	                   AND 1 != 1
	               </isEmpty>
	           	</isEmpty>
		        <!-- <isNotEmpty property="rcntAccDtm">
		            AND TO_CHAR(RB.REGST_DTM, 'yyyyMMdd') = #rcntAccDtm#
		        </isNotEmpty> -->
		        <isNotEmpty property="startDay">	            
	            	AND RB.REGST_DTM <![CDATA[ >= ]]>  TO_DATE(#startDay#||'000000', 'yyyyMMddHH24Miss')
		        </isNotEmpty>
		        <isNotEmpty property="endDay">	            
		            AND RB.REGST_DTM <![CDATA[ <= ]]>  TO_DATE(#endDay#||'235959', 'yyyyMMddHH24Miss')
		        </isNotEmpty>		        	        						
        ) A                   
        ORDER BY A.REGST_DTM DESC
    </select>
    
	<!-- 
	작성자: 
	작성일: 
	기능: 최근 검색한 키워드 등록
	-->
    <insert id="insertRecentKeyword" parameterClass="kr.co.hottracks.site.model.search.RecentKeyword">
        /* BizProductSQL.insertRecentKeyword */
        INSERT INTO TB_RECENT_KEYWORD (RCNT_KEY_SEQ, KEYWORD, SESN_HASH_KEY, USER_NUM, REGST_DTM)
                                    VALUES (RCNT_PRDT_SEQ.NEXTVAL, #keyword#, #sesnHashKey#, #userNum#, SYSDATE)
    </insert>
    
    <!-- 
        작성자: 장진용
        작성일: 2017.12.21
        기능: 최근 키워드 삭제
     -->
    <delete id="deleteRecentKeyword" parameterClass="kr.co.hottracks.site.model.search.RecentKeyword">
        /* BizProductSQL.deleteRecentKeyword */
        DELETE
          FROM TB_RECENT_KEYWORD RK
         WHERE KEYWORD = #keyword#
           <isNotEmpty property="userNum">
               AND RK.USER_NUM = #userNum#
           </isNotEmpty>
           <isNotEmpty property="sesnHashKey">
               AND RK.USER_NUM IS NULL
               AND RK.SESN_HASH_KEY = #sesnHashKey#
           </isNotEmpty>
           <isEmpty property="userNum">
               <isEmpty property="sesnHashKey">
                   AND 1 != 1
               </isEmpty>
           </isEmpty>
    </delete>
    
	<!-- 
	작성자: 
	작성일: 
	기능: 최근 본 이벤트 등록
	-->
    <insert id="insertRecentEvent" parameterClass="kr.co.hottracks.site.model.frontoffice.product.BizRecentProduct">
        /* BizProductSQL.insertRecentEvent */
        INSERT INTO TB_RECENT_EVENT (RCNT_EVENT_SEQ, EVENT_ID, SESN_HASH_KEY, USER_NUM, REGST_DTM)
                                    VALUES (RCNT_EVENT_SEQ.NEXTVAL, #eventId#, #sesnHashKey#, #userNum#, SYSDATE)
    </insert>
    
    <!-- 
	작성자: 
	작성일: 
	기능: 최근 본 이벤트 삭제
	-->
	<delete id="deleteRecentEvent" parameterClass="kr.co.hottracks.site.model.frontoffice.product.BizRecentProduct">
	    /* BizProductSQL.deleteRecentEvent */
	    DELETE
	      FROM TB_RECENT_EVENT RK
	     WHERE EVENT_ID = #eventId#
	       <isNotEmpty property="userNum">
	           AND RK.USER_NUM = #userNum#
	       </isNotEmpty>
	       <isNotEmpty property="sesnHashKey">
	           AND RK.USER_NUM IS NULL
	           AND RK.SESN_HASH_KEY = #sesnHashKey#
	       </isNotEmpty>
	       <isEmpty property="userNum">
	           <isEmpty property="sesnHashKey">
	               AND 1 != 1
	           </isEmpty>
	       </isEmpty>
	</delete>
	
    <!-- 
	작성자: 
	작성일: 
	기능: 최근 본 브랜드 등록
	-->
    <insert id="insertRecentBrand" parameterClass="kr.co.hottracks.site.model.frontoffice.product.BizRecentProduct">
        /* BizProductSQL.insertRecentBrand */
        INSERT INTO TB_RECENT_BRAND (RCNT_BRAND_SEQ, BRAND_ID, SESN_HASH_KEY, USER_NUM, REGST_DTM)
                                    VALUES (RCNT_BRAND_SEQ.NEXTVAL, #brandId#, #sesnHashKey#, #userNum#, SYSDATE)
    </insert>
    
   <!-- 
        작성자: 
        작성일: 
        기능: 최근 본 브랜드 삭제
     -->
    <delete id="deleteRecentBrand" parameterClass="kr.co.hottracks.site.model.frontoffice.product.BizRecentProduct">
        /* BizProductSQL.deleteRecentBrand */
        DELETE
          FROM TB_RECENT_BRAND
         WHERE BRAND_ID = #brandId#
           <isNotEmpty property="userNum">
               AND USER_NUM = #userNum#
           </isNotEmpty>
           <isNotEmpty property="sesnHashKey">
               AND USER_NUM IS NULL
               AND SESN_HASH_KEY = #sesnHashKey#
           </isNotEmpty>
           <isEmpty property="userNum">
               <isEmpty property="sesnHashKey">
                   AND 1 != 1
               </isEmpty>
           </isEmpty>
    </delete>  
</sqlMap>