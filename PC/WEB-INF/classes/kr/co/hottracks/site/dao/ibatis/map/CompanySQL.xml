<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="CompanySQL">
    <typeAlias alias="hpBoardCriteria" type="kr.co.hottracks.site.model.company.HpBoardCriteria"/>
    <typeAlias alias="hpBoardExt" type="kr.co.hottracks.site.model.company.HpBoardExt"/>
    <typeAlias alias="hpBoardFile" type="kr.co.hottracks.site.model.company.HpBoardFile"/>
    <typeAlias alias="hpBoardComment" type="kr.co.hottracks.site.model.company.HpBoardComment"/>
    <typeAlias alias="hpBoardCommentExt" type="kr.co.hottracks.site.model.company.HpBoardCommentExt"/>
    <!--  
        작성자: 장진용
        작성일 : 2016.01.13
        기능 : 영업점목록반환
    -->
    <select id="getStore" resultClass="kr.co.hottracks.site.model.company.HpDeptCode">
        /* CompanySQL.getStore */
        SELECT HDC.DEPTCODE     deptcode
             , HDC.DEPTNAME     deptname
             , HDC.STOREYN      storeyn
             , HDC.DISPYN       dispyn
             , HDC.RDP_CODE     rdpCode
             , HDC.RDP_TLNM     rdpTlnm
             , HDC.RDP_TIME     rdpTime
             , HDC.RDP_OFFDAY   rdpOffday
             , HDC.RDP_TRAFFIC  rdpTraffic
             , HDC.RDP_PARKING  rdpParking
             , HDC.RDP_ADDR     rdpAddr
             , HDC.DISP_ORDER   dispOrder
             , HDC.LOC_LAT      locLat
             , HDC.LOC_LONG     locLong
             , HDC.LOC_GBN_CODE locGbnCode
             , HDC.KYOBO_SITE   kyoboSite
             , C.CODE_NAME      locGbnName
          FROM TB_HP_DEPT_CODE HDC
          JOIN TB_CODE C ON HDC.LOC_GBN_CODE = C.CODE
         WHERE HDC.STOREYN = 'Y'
           AND HDC.DISPYN = 'Y'
         ORDER BY C.CODE_ORDER, HDC.DISP_ORDER, HDC.RDP_CODE
    </select>
    
    <!--  
        작성자: 장진용
        작성일 : 2016.01.13
        기능 : 영업점목록반환
    -->
    <select id="getStoreDetail" parameterClass="string" resultClass="kr.co.hottracks.site.model.company.HpDeptCode">
        /* CompanySQL.getStoreDetail */
        SELECT HDC.DEPTCODE     deptcode
             , HDC.DEPTNAME     deptname
             , HDC.STOREYN      storeyn
             , HDC.DISPYN       dispyn
             , HDC.RDP_CODE     rdpCode
             , HDC.RDP_TLNM     rdpTlnm
             , HDC.RDP_TIME     rdpTime
             , HDC.RDP_OFFDAY   rdpOffday
             , HDC.RDP_TRAFFIC  rdpTraffic
             , HDC.RDP_PARKING  rdpParking
             , HDC.RDP_ADDR     rdpAddr
          FROM TB_HP_DEPT_CODE HDC
         WHERE HDC.STOREYN = 'Y'
           AND HDC.DISPYN = 'Y'
           AND HDC.DEPTCODE = #deptcode#
         ORDER BY HDC.DEPTCODE
    </select>
    
    <!-- 
        작성자: 장진용
        작성일: 2014-05-22
        기능: 행사안내,추천상품,영업점이야기,영업점배너 목록 반환
    -->
    <select id="getHpBoardList" parameterClass="hpBoardCriteria" resultClass="hpBoardExt">
        /* CompanySQL.getHpBoardList */
        SELECT HB.BOARDSEQ          boardseq
             , HB.STARTDATE         startdate
             , HB.ENDDATE           enddate
             , HB.TYPE              type
             , HB.HITS              hits
             , HB.USEYN             useyn
             , HB.IMGURL            imgurl
             , HB.REGISTERID        registerid
             , HB.TITLE             title
             , TO_CHAR(HB.REGISTERDATE, 'yyyyMMdd')      registerdate
             , HB.LINKURL           linkurl
             , HB.BOARDID           boardid
             , HB.MODIFYDATE        modifydate
             , HB.COMMENTYN         commentyn
             , HB.MODIFYID          modifyid
             , HB.SECTION           section
             , HB.USED              used
             , CASE WHEN TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN HB.STARTDATE AND HB.ENDDATE THEN 'N'
                    WHEN TO_CHAR(SYSDATE, 'YYYYMMDD') &lt; HB.STARTDATE THEN 'S'
                    ELSE 'E'
                END                 prosGbn
             , CASE WHEN TO_CHAR(SYSDATE, 'YYYYMMDD') = TO_CHAR(HB.REGISTERDATE, 'YYYYMMDD') THEN 'Y'
                    ELSE 'N'
                END                 newYn
             , (SELECT SUBSTR(XMLAGG(XMLELEMENT(DEPTCODE, ','||T2.DEPTNAME) ORDER BY T1.DEPTCODE).EXTRACT('//text()'), 2) 
                  FROM TB_HP_BOARD_STORE T1
                  JOIN TB_HP_DEPT_CODE T2 ON T1.DEPTCODE = T2.DEPTCODE 
                 WHERE T1.BOARDSEQ = HB.BOARDSEQ)    deptnames
          FROM TB_HP_BOARD HB
          JOIN TB_HP_BOARD_STORE HBS ON HB.BOARDSEQ = HBS.BOARDSEQ AND HBS.DEPTCODE = #deptcode#
         WHERE HB.USED = 'Y'
           AND HB.USEYN = 'Y'
           AND HB.BOARDID = #boardid#
           <isNotEmpty property="boardseq">AND HB.BOARDSEQ = #boardseq#</isNotEmpty>
           <isNotEmpty property="section">AND HB.SECTION = #section#</isNotEmpty>
           <isNotEmpty property="srchKeyword">
               <isEqual property="srchGbn" compareValue="T">AND UPPER(HB.TITLE) LIKE '%' || UPPER(#srchKeyword#) || '%'</isEqual>
               <isEqual property="srchGbn" compareValue="C">AND UPPER(HB.CONTENTS) LIKE '%' || UPPER(#srchKeyword#) || '%'</isEqual>
               <isEqual property="srchGbn" compareValue="A">AND (UPPER(HB.TITLE) LIKE '%' || UPPER(#srchKeyword#) || '%' OR UPPER(HB.TITLE) LIKE '%' || UPPER(#srchKeyword#) || '%')</isEqual>
           </isNotEmpty>
         ORDER BY HB.BOARDSEQ DESC
    </select>
    
    <!-- 
        작성자: 장진용
        작성일: 2014-05-22
        기능: 행사안내,추천상품,영업점이야기,영업점배너 목록수 반환
    -->
    <select id="countHpBoardList" parameterClass="hpBoardCriteria" resultClass="int">
        /* CompanySQL.countHpBoardList */
        SELECT COUNT(*)
          FROM TB_HP_BOARD HB
          JOIN TB_HP_BOARD_STORE HBS ON HB.BOARDSEQ = HBS.BOARDSEQ AND HBS.DEPTCODE = #deptcode#
         WHERE HB.USED = 'Y'
           AND HB.USEYN = 'Y'
           AND HB.BOARDID = #boardid#
           <isNotEmpty property="boardseq">AND HB.BOARDSEQ = #boardseq#</isNotEmpty>
           <isNotEmpty property="section">AND HB.SECTION = #section#</isNotEmpty>
           <isNotEmpty property="srchKeyword">
               <isEqual property="srchGbn" compareValue="T">AND UPPER(HB.TITLE) LIKE '%' || UPPER(#srchKeyword#) || '%'</isEqual>
               <isEqual property="srchGbn" compareValue="C">AND UPPER(HB.CONTENTS) LIKE '%' || UPPER(#srchKeyword#) || '%'</isEqual>
               <isEqual property="srchGbn" compareValue="A">AND (UPPER(HB.TITLE) LIKE '%' || UPPER(#srchKeyword#) || '%' OR UPPER(HB.TITLE) LIKE '%' || UPPER(#srchKeyword#) || '%')</isEqual>
           </isNotEmpty>
           <isEqual property="pageYn" compareValue="Y">
               AND ROWNUM &lt; #topCount# + 1
           </isEqual>
    </select>
    
    <!--
        작성자: 장진용
        작성일 : 2016.01.13
        기능 : 게시글 목록 반환
    -->
    <select id="getHpBoardDetail" parameterClass="string" resultClass="string">
        /* CompanySQL.getHpBoardDetail */
        SELECT HB.CONTENTS          contents
          FROM TB_HP_BOARD HB
         WHERE HB.USEYN = 'Y'
           AND HB.USED = 'Y'
           AND HB.BOARDSEQ = #boardseq#
    </select>
    
    <!-- 
        작성자: 장진용
        작성일: 2014-05-22
        기능: 첨부파일 정보 반환
    -->
    <select id="getHpBoardFile" parameterClass="string" resultClass="hpBoardFile">
        /* CompanySQL.getHpBoardFile */
        SELECT FILESEQ      fileseq
             , FILEPATH     filepath
             , FILENAME     filename
             , FILESIZE     filesize
             , BOARDSEQ     boardseq
             , FILEEXT      fileext
          FROM TB_HP_BOARD_FILE
         WHERE boardSeq = #boardseq#
    </select>
    
    <!-- 
        작성자: 장진용
        작성일: 2014-05-22
        기능: 공지사항 목록 반환
    -->
    <select id="getHpNotice" parameterClass="hpBoardCriteria" resultClass="hpBoardExt">
        /* CompanySQL.getHpNotice */
        SELECT HB.BOARDSEQ          boardseq
             , HB.STARTDATE         startdate
             , HB.ENDDATE           enddate
             , HB.TYPE              type
             , HB.HITS              hits
             , HB.USEYN             useyn
             , HB.IMGURL            imgurl
             , HB.REGISTERID        registerid
             , HB.TITLE             title
             , TO_CHAR(HB.REGISTERDATE, 'yyyyMMdd')      registerdate
             , HB.LINKURL           linkurl
             , HB.BOARDID           boardid
             , HB.MODIFYDATE        modifydate
             , HB.COMMENTYN         commentyn
             , HB.MODIFYID          modifyid
             , HB.SECTION           section
             , HB.USED              used
             , CASE WHEN TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN HB.STARTDATE AND HB.ENDDATE THEN 'N'
                    WHEN TO_CHAR(SYSDATE, 'YYYYMMDD') &lt; HB.STARTDATE THEN 'S'
                    ELSE 'E'
                END                 prosGbn
             , CASE WHEN TO_CHAR(SYSDATE, 'YYYYMMDD') = TO_CHAR(HB.REGISTERDATE, 'YYYYMMDD') THEN 'Y'
                    ELSE 'N'
                END                 newYn
             , (SELECT SUBSTR(XMLAGG(XMLELEMENT(DEPTCODE, ','||T2.DEPTNAME) ORDER BY T1.DEPTCODE).EXTRACT('//text()'), 2) 
                  FROM TB_HP_BOARD_STORE T1
                  JOIN TB_HP_DEPT_CODE T2 ON T1.DEPTCODE = T2.DEPTCODE 
                 WHERE T1.BOARDSEQ = HB.BOARDSEQ)    deptnames
          FROM TB_HP_BOARD HB
         WHERE HB.USEYN = 'Y'
           AND HB.USED = 'Y'
           AND HB.BOARDID = #boardid#
           <isNotEmpty property="boardseq">AND HB.BOARDSEQ = #boardseq#</isNotEmpty>
           <isNotEmpty property="section">AND HB.SECTION = #section#</isNotEmpty>
           <isNotEmpty property="srchKeyword">
               <isEqual property="srchGbn" compareValue="T">AND UPPER(HB.TITLE) LIKE '%' || UPPER(#srchKeyword#) || '%'</isEqual>
               <isEqual property="srchGbn" compareValue="C">AND UPPER(HB.CONTENTS) LIKE '%' || UPPER(#srchKeyword#) || '%'</isEqual>
               <isEqual property="srchGbn" compareValue="A">AND (UPPER(HB.TITLE) LIKE '%' || UPPER(#srchKeyword#) || '%' OR UPPER(HB.TITLE) LIKE '%' || UPPER(#srchKeyword#) || '%')</isEqual>
           </isNotEmpty>
         ORDER BY HB.BOARDSEQ DESC
    </select>
    
    <!-- 
        작성자: 장진용
        작성일: 2014-05-22
        기능: 공지사항 목록수 반환
    -->
    <select id="countHpNotice" parameterClass="hpBoardCriteria" resultClass="int">
        /* CompanySQL.countHpNotice */
        SELECT count(*)
          FROM TB_HP_BOARD HB
         WHERE HB.USEYN = 'Y'
           AND HB.USED = 'Y'
           AND HB.BOARDID = #boardid#
           <isNotEmpty property="boardseq">AND HB.BOARDSEQ = #boardseq#</isNotEmpty>
           <isNotEmpty property="section">AND HB.SECTION = #section#</isNotEmpty>
           <isNotEmpty property="srchKeyword">
               <isEqual property="srchGbn" compareValue="T">AND UPPER(HB.TITLE) LIKE '%' || UPPER(#srchKeyword#) || '%'</isEqual>
               <isEqual property="srchGbn" compareValue="C">AND UPPER(HB.CONTENTS) LIKE '%' || UPPER(#srchKeyword#) || '%'</isEqual>
               <isEqual property="srchGbn" compareValue="A">AND (UPPER(HB.TITLE) LIKE '%' || UPPER(#srchKeyword#) || '%' OR UPPER(HB.TITLE) LIKE '%' || UPPER(#srchKeyword#) || '%')</isEqual>
           </isNotEmpty>
           <isEqual property="pageYn" compareValue="Y">
               AND ROWNUM &lt; #topCount# + 1
           </isEqual>
    </select>
    
    <update id="updateHpBoardHit" parameterClass="hpBoardCriteria">
        /* CompanySQL.updateHpBoardHit */
        UPDATE TB_HP_BOARD 
           SET HITS = HITS+1
         WHERE BOARDSEQ =  #boardseq#
           AND BOARDID = #boardid#
    </update>
    
    <!-- 
        작성자: 장진용
        작성일: 2016-01-18
        기능: 게시글 코멘트 목록
     -->
    <select id="getHpBoardComment" parameterClass="hpBoardCriteria" resultClass="hpBoardCommentExt">
        /* CompanySQL.getHpBoardComment */
        SELECT HBC.BOARDSEQ     boardseq
             , HBC.CONTENTS     contents
             , HBC.REGISTERID   registerid
             , HBC.COMMENTSEQ   commentseq
             , TO_CHAR(HB.REGISTERDATE, 'yyyyMMdd')      registerdate
          FROM TB_HP_BOARD_COMMENT HBC
         WHERE HBC.BOARDSEQ = #boardseq#
           <isNotEmpty property="registerid">
               AND HBC.REGISTERID = #registerid#
           </isNotEmpty>
         ORDER BY HBC.COMMENTSEQ DESC
    </select>
    
    <!-- 
        작성자: 장진용
        작성일: 2016-01-18
        기능: 게시글 코멘트 목록 수
     -->
    <select id="countHpBoardComment" parameterClass="hpBoardCriteria" resultClass="int">
        /* CompanySQL.countHpBoardComment */
        SELECT COUNT(*)
          FROM TB_HP_BOARD_COMMENT HBC
         WHERE HBC.BOARDSEQ = #boardseq#
           <isNotEmpty property="registerid">
               AND HBC.REGISTERID = #registerid#
           </isNotEmpty>
           <isEqual property="pageYn" compareValue="Y">
               AND ROWNUM &lt; #topCount# + 1
           </isEqual>
    </select>
    
    <!-- 
        작성자: 권동희
        작성일: 2017-03-23
        기능: 영업점별 알려드립니다 반환
     -->
     <select id="getHpBoardByStore" parameterClass="string" resultClass="hpBoardExt">
        /* CompanySQL.getHpBoardByStore */
        SELECT HB.BOARDSEQ          boardseq
             , HB.TITLE             title
             , HB.STARTDATE         startdate
             , HB.ENDDATE           enddate
             , HB.HITS              hits
             , HB.USEYN             useyn
             , CASE WHEN TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN HB.STARTDATE AND HB.ENDDATE THEN 'N'
                    WHEN TO_CHAR(SYSDATE, 'YYYYMMDD') &lt; HB.STARTDATE THEN 'S'
                    ELSE 'E'
                END                 prosGbn
             , CASE WHEN TO_CHAR(SYSDATE, 'YYYYMMDD') = TO_CHAR(HB.REGISTERDATE, 'YYYYMMDD') THEN 'Y'
                    ELSE 'N'
                END                 newYn
          FROM TB_HP_BOARD HB  
          JOIN TB_HP_BOARD_STORE HBS ON HB.BOARDSEQ = HBS.BOARDSEQ
         WHERE HBS.DEPTCODE = #deptCode#
           AND HB.USEYN = 'Y'
           AND HB.USED = 'Y'
        ORDER BY HB.BOARDSEQ DESC
     </select>
     
     <!-- 
        작성자: 권동희
        작성일: 2017-03-23
        기능: 영업점별 알려드립니다 개수 반환
     -->
     <select id="countHpBoardByStore" parameterClass="string" resultClass="int">
        /* CompanySQL.countHpBoardByStore */
        SELECT count(*)
          FROM TB_HP_BOARD HB  
          JOIN TB_HP_BOARD_STORE HBS ON HB.BOARDSEQ = HBS.BOARDSEQ
         WHERE HBS.DEPTCODE = #deptCode#
           AND HB.USEYN = 'Y'
           AND HB.USED = 'Y'
        ORDER BY HB.BOARDSEQ DESC
     </select>
     
    <!--
        작성자: 장진용
        작성일: 2016-01-25
        기능: 게시글 코멘트 등록 
     -->
    <insert id="insertHpBoardComment" parameterClass="hpBoardComment">
        /* CompanySQL.insertHpBoardComment */
        INSERT INTO TB_HP_BOARD_COMMENT (BOARDSEQ, CONTENTS, REGISTERID, COMMENTSEQ, REGISTERDATE)
                                 VALUES (#boardseq#, #contents#, #registerid#, HP_COMMENTSEQ.NEXTVAL, SYSDATE)
    </insert>
    
    <!--
        작성자: 장진용
        작성일: 2016-01-25
        기능: 게시글 코멘트 삭제 
     -->
    <delete id="deleteHpBoardComment" parameterClass="hpBoardComment">
        /* CompanySQL.deleteHpBoardComment */
        DELETE FROM TB_HP_BOARD_COMMENT
              WHERE REGISTERID = #registerid#
                AND COMMENTSEQ = #commentseq#
    </delete>
    
    <!-- 
        작성자: 장진용
        작성일: 2014-05-22
        기능: 팝업 목록 반환
    -->
    <select id="getHpPopup" parameterClass="hpBoardCriteria" resultClass="hpBoardExt">
        /* CompanySQL.getHpPopup */
        SELECT HB.BOARDSEQ          boardseq
             , HB.STARTDATE         startdate
             , HB.ENDDATE           enddate
             , HB.TYPE              type
             , HB.HITS              hits
             , HB.USEYN             useyn
             , HB.IMGURL            imgurl
             , HB.REGISTERID        registerid
             , HB.TITLE             title
             , TO_CHAR(HB.REGISTERDATE, 'yyyyMMdd')      registerdate
             , HB.LINKURL           linkurl
             , HB.BOARDID           boardid
             , HB.MODIFYDATE        modifydate
             , HB.COMMENTYN         commentyn
             , HB.MODIFYID          modifyid
             , HB.SECTION           section
             , HB.USED              used
          FROM TB_HP_BOARD HB
         WHERE HB.USED = 'Y'
           AND HB.BOARDID = '10'
           AND TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN HB.STARTDATE AND HB.ENDDATE
           <isNotEmpty property="boardseq">AND HB.BOARDSEQ = #boardseq#</isNotEmpty>
         ORDER BY HB.BOARDSEQ DESC
    </select>
</sqlMap>