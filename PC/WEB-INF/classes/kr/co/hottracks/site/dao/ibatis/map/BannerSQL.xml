<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="BannerSQL">
    <typeAlias alias="clickParam" type="kr.co.hottracks.site.model.common.banner.ClickParam"/>
      
    <!-- 
        기능 : 배너 클릭 정보를 등록한다.
        작성일 : 2013.03.07
        작성자 : 서국영
    -->
    <insert id="bannerClick" parameterClass="clickParam">
        /* BannerSQL.bannerClick */
        insert into TB_BANNER_CLICK (GUBUN, CLICK_DT, CLICK_SEQ, USER_NUM, REGDT)
        select #bannerGubun#
             , to_char(sysdate,'yyyymmdd')
             , (select nvl(max(CLICK_SEQ),0) + 1 from TB_BANNER_CLICK where GUBUN = #bannerGubun# and CLICK_DT = to_char(sysdate,'yyyymmdd'))
             , #userNum#
             , sysdate
          from dual
    </insert>
   
    <!-- 
        기능 : 배너 클릭 정보를 반환한다.
        작성일 : 2013.03.07
        작성자 : 장진용
    -->
    <select id="getBannerClick" parameterClass="clickParam" resultClass="clickParam">
        /* BannerSQL.getBannerClick */
        SELECT GUBUN        bannerGubun
             , CLICK_DT     clickDt
             , CLICK_SEQ    clickSeq
             , USER_NUM     userNum
             , REGDT        regdt
          FROM TB_BANNER_CLICK
         WHERE GUBUN = #bannerGubun#
           AND USER_NUM = #userNum#
           <isNotEmpty property="clickDt" prepend="AND">
               <isEqual property="clickDt" compareValue="TODAY">CLICK_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')</isEqual>
               <isNotEqual property="clickDt" compareValue="TODAY">CLICK_DT = #clickDt#</isNotEqual>
           </isNotEmpty>
    </select>
    
    <parameterMap id="clientClickInput" class="java.util.Map">
        <parameter property="V_VAL1" javaType="java.lang.String" jdbcType="VARCHAR" mode="IN" />
        <parameter property="V_VAL2" javaType="java.lang.String" jdbcType="VARCHAR" mode="IN" />
        <parameter property="V_VAL3" javaType="java.lang.String" jdbcType="VARCHAR" mode="OUT" />
    </parameterMap>
    
    <procedure id="clientClick" parameterMap="clientClickInput">
        { call PR_CLIENTCLICK(?,?,?) }
    </procedure>
</sqlMap>