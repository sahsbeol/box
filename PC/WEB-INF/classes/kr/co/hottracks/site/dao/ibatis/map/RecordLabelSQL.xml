<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="RecordLabelSQL">
    <typeAlias alias="recordLabelCriteria" type="kr.co.hottracks.site.model.common.record.RecordLabelCriteria"/>
    <typeAlias alias="recordLabelExt" type="kr.co.hottracks.site.model.common.record.RecordLabelExt"/>
    <typeAlias alias="labelInStorageInfoCriteria" type="kr.co.hottracks.site.model.common.record.LabelInStorageInfoCriteria"/>
    <typeAlias alias="labelInStorageInfoExt" type="kr.co.hottracks.site.model.common.record.LabelInStorageInfoExt"/>
    <typeAlias alias="labelEventMstExt" type="kr.co.hottracks.site.model.common.record.LabelEventMstExt"/>
    <typeAlias alias="labelEventExt" type="kr.co.hottracks.site.model.common.record.LabelEventExt"/>
    <typeAlias alias="labelEventCriteria" type="kr.co.hottracks.site.model.common.record.LabelEventCriteria"/>
    
    <!--
        작성자 : 김기석
        작성일 : 2011.07.05
        기능 : 
            레코드 레이블 선택 공통 조건절
    -->
    <sql id="getRecordLabelWhere">
        <dynamic prepend="where">
            <isEqual property="listCountYn" removeFirstPrepend="true" prepend="and" compareValue="Y">
                rownum <![CDATA[ < ]]> #topCount# + 1
            </isEqual>      
            <isNotEmpty property="keyWord" removeFirstPrepend="true" prepend="and">
                <isEqual property="keyField" compareValue="code"> a.label_cd like '%'||#keyWord#||'%' </isEqual>
                <isEqual property="keyField" compareValue="name"> a.label_name like '%'||#keyWord#||'%' </isEqual>
            </isNotEmpty>
            <isNotEmpty property="searchValue" removeFirstPrepend="true" prepend="and">
                <isNotEqual property="searchValue" compareValue="etc">
                    UPPER(a.label_name) like #searchValue# || '%'
                </isNotEqual>
                <isEqual property="searchValue" compareValue="etc">
                    a.label_name <![CDATA[ < ]]> 'A'
                </isEqual>
                and 
                exists (
                    select 1 from tb_record t1
                    where t1.label_cd = a.label_cd and t1.imp_yn = 'Y'
                )
            </isNotEmpty>
        </dynamic>
    </sql>    
    
    
    <!--
        작성자 : 김기석
        작성일 : 2011.07.05
        기능 : 레코드 레이블 선택 
    -->
    <select id="getRecordLabel" parameterClass="recordLabelCriteria" resultClass="recordLabelExt">
        /* RecordLabelSQL.getRecordLabel */
        SELECT A.LABEL_CD           code
             , A.LABEL_NAME         name
             , A.KOR_LABEL_NAME     korName
             , A.SYNO_LABEL_NAME    synonymName 
        FROM TB_REC_LABEL A
        <include refid="getRecordLabelWhere" />
    </select>

    <!--
        작성자 : 김기석
        작성일 : 2011.07.05
        기능 : 레코드 레이블 선택 목록 개수 반환
    -->
    <select id="getRecordLabelListCount" parameterClass="recordLabelCriteria" resultClass="int">
        /* RecordLabelSQL.getRecordLabelListCount */
        SELECT COUNT(*) AS CNT 
          FROM TB_REC_LABEL A
        <include refid="getRecordLabelWhere" />
    </select>

    <!--
        작성자 : 김기석
        작성일 : 2011.07.07
        기능 : 레이블 입고안내 마스터 정보를 반환 - 공통 조건절
    -->
    <sql id="getLabelInStorageInfoWhere">
        <dynamic prepend="where">
            <isEqual property="listCountYn" removeFirstPrepend="true" prepend="and" compareValue="Y">
                rownum <![CDATA[ < ]]> #topCount# + 1
            </isEqual>
            <isNotEmpty property="keyWord" removeFirstPrepend="true" prepend="and">
                <isEqual property="keyField" compareValue="labelClassId"> a.label_class_id like '%'||#keyWord#||'%' </isEqual>
                <isEqual property="keyField" compareValue="clssName"> a.clss_name like '%'||#keyWord#||'%' </isEqual>
                <isEqual property="keyField" compareValue="labelCd"> a.label_cd like '%'||#keyWord#||'%' </isEqual>
            </isNotEmpty>
            <isNotEmpty property="labelGbn" removeFirstPrepend="true" prepend="and">
                a.label_gbn = #labelGbn#
            </isNotEmpty>
            <isNotEmpty property="useYn" removeFirstPrepend="true" prepend="and">
                a.use_yn = #useYn#
            </isNotEmpty>
            <isGreaterThan property="labelClassId" compareValue="0" removeFirstPrepend="true" prepend="and">
                a.label_class_id = #labelClassId#
            </isGreaterThan>
        </dynamic>
    </sql>



    <!--
        작성자 : 김기석
        작성일 : 2011.07.07
        기능 : 레이블 입고안내 마스터 정보를 반환
    -->
    <select id="getLabelInStorageInfo" parameterClass="labelInStorageInfoCriteria" resultClass="labelInStorageInfoExt">
        /* RecordLabelSQL.getLabelInStorageInfo */
        SELECT A.LABEL_CLASS_ID     labelClassId
             , A.CLSS_NAME          clssName
             , A.LABEL_GBN          labelGbn
             , A.USE_YN             useYn
             , A.REGST_DTM          regstDtm
             , A.MOD_DTM            modDtm
             , A.ADMIN_ID           adminId
             , A.LABEL_CD           labelCd
             , B.LABEL_NAME         labelName 
        FROM TB_LABEL_STRG_INFO A
        LEFT JOIN TB_REC_LABEL B ON A.LABEL_CD = B.LABEL_CD
        <include refid="getLabelInStorageInfoWhere" />
        ORDER BY A.REGST_DTM DESC
    </select>


    <!--
        작성자 : 김기석
        작성일 : 2011.07.07
        기능 : 레이블 입고안내 마스터 정보를 목록 개수 반환
    -->
    <select id="getLabelInStorageInfoListCount" parameterClass="labelInStorageInfoCriteria" resultClass="int">
        /* RecordLabelSQL.getLabelInStorageInfoListCount */
        SELECT COUNT(*) AS CNT 
          FROM TB_LABEL_STRG_INFO A
          LEFT JOIN TB_REC_LABEL B ON A.LABEL_CD = B.LABEL_CD
        <include refid="getLabelInStorageInfoWhere" />
    </select>
    
    <!--
        작성자 : 김기석
        작성일 : 2011.07.15
        기능 : 
            레이블 행사안내 마스터 정보 반환 - 별도의 페이징. 조건처리 없음.
    -->
    <select id="getLabelEventMst" resultClass="labelEventMstExt">
        /* RecordLabelSQL.getLabelEventMst */
        SELECT A.LABEL_EVENT_MST_SEQ    labelEventMstSeq
             , A.MST_NAME               mstName
             , A.IMAGE_URL              imageUrl
             , A.LINK_URL               linkUrl
             , A.IMAGE_URL_ON           imageUrlOn
             , A.IMAGE_URL_OFF          imageUrlOff 
          FROM TB_LABEL_EVENT_MST A
         ORDER BY A.LABEL_EVENT_MST_SEQ
    </select>
    
        <!--
        작성자 : 김기석
        작성일 : 2011.07.18
        기능 : 
            레이블 행사 정보를 반환 - 공통 조건절
    -->
    <sql id="getLabelEventWhere">
        <dynamic prepend="where">
            <isEqual property="listCountYn" removeFirstPrepend="true" prepend="and" compareValue="Y">
                ROWNUM <![CDATA[ < ]]> #topCount# + 1
            </isEqual>
            <isNotEmpty property="keyWord" removeFirstPrepend="true" prepend="and">
                <isEqual property="keyField" compareValue="title"> A.TITLE LIKE '%'||#keyWord#||'%' </isEqual>
                <isEqual property="keyField" compareValue="eventId"> A.EVENT_ID LIKE '%'||#keyWord#||'%' </isEqual>
                <isEqual property="keyField" compareValue="sellPrdtBcode"> A.SELL_PRDT_BCODE LIKE '%'||#keyWord#||'%' </isEqual>
            </isNotEmpty>
            <isNotEmpty property="labelEventLinkCode" removeFirstPrepend="true" prepend="and">
                A.LABEL_EVENT_LINK_CODE = #labelEventLinkCode#
            </isNotEmpty>
            <isGreaterThan property="labelEventSeq" compareValue="0" removeFirstPrepend="true" prepend="and">
                A.LABEL_EVENT_SEQ = #labelEventSeq#
            </isGreaterThan>
            <isGreaterThan property="labelEventMstSeq" compareValue="0" removeFirstPrepend="true" prepend="and">
                A.LABEL_EVENT_MST_SEQ = #labelEventMstSeq#
            </isGreaterThan>
        </dynamic>
    </sql>

    <!--
        작성자 : 김기석
        작성일 : 2011.07.18
        기능 : 
            레이블 행사 정보를 반환
    -->
    <select id="getLabelEvent" parameterClass="labelEventCriteria" resultClass="labelEventExt">
        /* RecordLabelSQL.getLabelEvent */
        SELECT A.LABEL_EVENT_SEQ        labelEventSeq
             , A.LABEL_EVENT_MST_SEQ    labelEventMstSeq
             , (SELECT T.MST_NAME FROM TB_LABEL_EVENT_MST T WHERE A.LABEL_EVENT_MST_SEQ = T.LABEL_EVENT_MST_SEQ)    mstName
             , A.LABEL_EVENT_LINK_CODE  labelEventLinkCode
             , A.EVENT_ID               eventId
             , A.SELL_PRDT_BCODE        sellPrdtBcode
             , A.TITLE                  title
             , A.DISP_ORDER             dispOrder
             , A.REGST_DTM              regstDtm
             , A.MOD_DTM                modDtm
             , A.ADMIN_ID               adminId
             , B.PRDT_NAME              sellPrdtName
             , C.EVENT_TITLE            eventNm 
          FROM TB_LABEL_EVENT A
          LEFT JOIN TB_SELL_PRODUCT B ON A.SELL_PRDT_BCODE = B.SELL_PRDT_BCODE
          LEFT JOIN TB_EVENT_MASTER C ON A.EVENT_ID = C.EVENT_ID
         <include refid="getLabelEventWhere" />
         ORDER BY A.DISP_ORDER
    </select>
</sqlMap>