<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="RecordStockedInfoReqSQL">
    <typeAlias alias="recordStockedInfoReqParam" type="kr.co.hottracks.site.model.common.record.RecordStockedInfoReqParam"/>
    <typeAlias alias="recordStockedInfoReqExt" type="kr.co.hottracks.site.model.common.record.RecordStockedInfoReqExt"/>
    
    <!--
        작성자 : 김기석
        작성일 : 2011.09.14
        기능 : 
            음반 입고 안내 신청 등록 처리
    -->
    <insert id="createRecordStockedInfoReq" parameterClass="recordStockedInfoReqParam">
        <selectKey keyProperty="recStockedInfoReqSeq" resultClass="int" type="pre">SELECT REC_STOCKED_INFO_REQ_SEQ.NEXTVAL FROM DUAL</selectKey>
        INSERT INTO TB_REC_STOCKED_INFO_REQ (REC_STOCKED_INFO_REQ_SEQ, RCRD_CD, USER_NUM, MALL_ID, MAIL, HP, MAIL_YN, SMS_YN, MAIL_END_YN, SMS_END_YN, REGST_DTM) 
                                     VALUES (#recStockedInfoReqSeq#, #rcrdCd#, #userNum#, #mallId#, #mail#, #hp#, #mailYn#, #smsYn#, #mailEndYn#, #smsEndYn#, sysdate)
    </insert>
    
    <!--
        작성자 : 김기석
        작성일 : 2011.09.14
        기능 : 
            음반 입고 안내 신청 등록 처리
    -->
    <insert id="createKyoboRecordStockedInfoReq" parameterClass="recordStockedInfoReqParam">
        <selectKey keyProperty="recStockedInfoReqSeq" resultClass="int" type="pre">SELECT ALARM_SEQ.NEXTVAL FROM DUAL</selectKey>
        INSERT INTO GIFTMALL.EST_HT_ALARM(SEQNO, MEMID, EMAIL, BARCODE, EJK_GB, REG_YMD, FLAG) 
        VALUES(  #recStockedInfoReqSeq#
               , (SELECT USER_ID FROM TB_USER WHERE USER_NUM = #userNum#)
               , #mail#
               , (SELECT SELL_PRDT_BCODE FROM TB_RECORD WHERE RCRD_CD = #rcrdCd#)
               , (SELECT DECODE(SELL_PRDT_GBN, 'D', 'DVD' ,'R','MUC') 
                    FROM TB_RECORD A
                    JOIN TB_SELL_PRODUCT B ON A.SELL_PRDT_BCODE = B.SELL_PRDT_BCODE
                   WHERE A.RCRD_CD = #rcrdCd#
                 )
               , TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
               , 'N'
              )
    </insert>

    <!--
        작성자 : 김기석
        작성일 : 2011.09.14
        기능 : 
            음반 입고 안내 신청 중복등록 체크용 쿼리
    -->
    <select id="getRecordStockedInfoReqForValidate" parameterClass="recordStockedInfoReqParam" resultClass="recordStockedInfoReqExt">
        SELECT A.REC_STOCKED_INFO_REQ_SEQ   recStockedInfoReqSeq 
          FROM TB_REC_STOCKED_INFO_REQ A
         WHERE A.USER_NUM = #userNum#
           AND A.MALL_ID = #mallId#
           AND A.RCRD_CD = #rcrdCd#
           AND A.MAIL_END_YN = #mailEndYn#
           AND A.SMS_END_YN = #smsEndYn# 
    </select>
</sqlMap>