<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="TrackSQL">
    <typeAlias alias="playItem" type="kr.co.hottracks.site.model.frontoffice.player.PlayItem"/>
    
    <!--
        작성자 : 조형우
        작성일 : 2011.11.03
        기능 : 플레이할 곡 정보 조회(핫트랙스 플레이어용)
    -->
    <select id="getPlayTrkInfoHot" parameterClass="playItem" resultClass="playItem">
        /* TrackSQL.getPlayTrkInfoHot */
        select A.RCRD_CD        musicCd
             , A.CD_NO          cdNo
             , A.TRK_NO         trackNo
             , A.AUDIO_PATH     path
             , A.AUDIO_URL1     url1
             , A.AUDIO_URL2     url2
             , A.AUDIO_URL3     url3
             , NULL             cate01Cd
             , INITCAP(B.ARTI_NAME)     artistNm
             , INITCAP(B.RCRD_NAME)     albumNm
             , NVL(INITCAP(A.TRK_NAME),'')  trackSong
             , NVL(A.AUDIO_YN,'')       wmAudioGb
             , SUBSTR(B.RLSE_DT,1,4)||'년'||SUBSTR(B.RLSE_DT,5,2)||'월'||SUBSTR(B.RLSE_DT,7,2)||'일'   chulsiDay
             , NULL             imgUrl
             , (select t.sell_prdt_gbn from tb_sell_product t where t.rcrd_cd = A.rcrd_cd and rownum = 1)   sellPrdtGbn
             , decode((select t.rcrd_cd from tb_rec_trk_full_listen t where t.rcrd_cd = a.rcrd_cd and t.cd_no = a.cd_no and t.trk_no = a.trk_no AND TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN START_DT AND END_DT), null, 'N', 'Y')  fullYn
          from TB_REC_TRACK A
             , TB_RECORD B
         where A.RCRD_CD = #musicCd#
           and A.CD_NO = #cdNo#
           and A.TRK_NO = #trackNo#
           AND A.RCRD_CD = B.RCRD_CD
           AND B.MEDIA_CD != '66'
           AND A.AUDIO_YN = 'Y'
         ORDER BY CD_NO, TRK_NO
    </select>
</sqlMap>